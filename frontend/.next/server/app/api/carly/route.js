/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/carly/route";
exports.ids = ["app/api/carly/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fcarly%2Froute&page=%2Fapi%2Fcarly%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcarly%2Froute.ts&appDir=%2FUsers%2Fstal%2FDocuments%2FProjects%2Fcurricalign%2Ffrontend%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fstal%2FDocuments%2FProjects%2Fcurricalign%2Ffrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fcarly%2Froute&page=%2Fapi%2Fcarly%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcarly%2Froute.ts&appDir=%2FUsers%2Fstal%2FDocuments%2FProjects%2Fcurricalign%2Ffrontend%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fstal%2FDocuments%2FProjects%2Fcurricalign%2Ffrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handler: () => (/* binding */ handler),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/server/request-meta */ \"(rsc)/./node_modules/next/dist/server/request-meta.js\");\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(rsc)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/shared/lib/router/utils/app-paths */ \"next/dist/shared/lib/router/utils/app-paths\");\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/base-http/node */ \"(rsc)/./node_modules/next/dist/server/base-http/node.js\");\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! next/dist/server/web/spec-extension/adapters/next-request */ \"(rsc)/./node_modules/next/dist/server/web/spec-extension/adapters/next-request.js\");\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(rsc)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! next/dist/server/instrumentation/utils */ \"(rsc)/./node_modules/next/dist/server/instrumentation/utils.js\");\n/* harmony import */ var next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! next/dist/server/send-response */ \"(rsc)/./node_modules/next/dist/server/send-response.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! next/dist/server/web/utils */ \"(rsc)/./node_modules/next/dist/server/web/utils.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! next/dist/server/lib/cache-control */ \"(rsc)/./node_modules/next/dist/server/lib/cache-control.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! next/dist/lib/constants */ \"(rsc)/./node_modules/next/dist/lib/constants.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__);\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! next/dist/shared/lib/no-fallback-error.external */ \"next/dist/shared/lib/no-fallback-error.external\");\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__);\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! next/dist/server/response-cache */ \"(rsc)/./node_modules/next/dist/server/response-cache/index.js\");\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__);\n/* harmony import */ var _Users_stal_Documents_Projects_curricalign_frontend_src_app_api_carly_route_ts__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./src/app/api/carly/route.ts */ \"(rsc)/./src/app/api/carly/route.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/carly/route\",\n        pathname: \"/api/carly\",\n        filename: \"route\",\n        bundlePath: \"app/api/carly/route\"\n    },\n    distDir: \".next\" || 0,\n    projectDir:  false || '',\n    resolvedPagePath: \"/Users/stal/Documents/Projects/curricalign/frontend/src/app/api/carly/route.ts\",\n    nextConfigOutput,\n    userland: _Users_stal_Documents_Projects_curricalign_frontend_src_app_api_carly_route_ts__WEBPACK_IMPORTED_MODULE_16__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\nasync function handler(req, res, ctx) {\n    var _nextConfig_experimental;\n    let srcPage = \"/api/carly/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {} else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = \"false\";\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname } = prepareResult;\n    const normalizedSrcPage = (0,next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__.normalizeAppPath)(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                throw new next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isRevalidate = isIsr && !supportsDynamicResponse;\n    const method = req.method || 'GET';\n    const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.getTracer)();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                dynamicIO: Boolean(nextConfig.experimental.dynamicIO),\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            supportsDynamicResponse,\n            incrementalCache: (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'incrementalCache'),\n            cacheLifeProfiles: (_nextConfig_experimental = nextConfig.experimental) == null ? void 0 : _nextConfig_experimental.cacheLife,\n            isRevalidate,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextRequest(req);\n    const nodeNextRes = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextResponse(res);\n    const nextReq = next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.NextRequestAdapter.fromNodeNextRequest(nodeNextReq, (0,next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.signalFromNodeResponse)(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        };\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.toNodeOutgoingHttpHeaders)(response.headers);\n                        if (cacheTags) {\n                            headers[next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                                isRevalidate,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode')) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.fromNodeOutgoingHttpHeaders)(cacheEntry.value.headers);\n            if (!((0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isIsr)) {\n                headers.delete(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', (0,next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__.getCacheControlHeader)(cacheEntry.cacheControl));\n            }\n            await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        // if we aren't wrapped by base-server handle here\n        if (!activeSpan && !(err instanceof next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                    isRevalidate,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZjYXJseSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGY2FybHklMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZjYXJseSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnN0YWwlMkZEb2N1bWVudHMlMkZQcm9qZWN0cyUyRmN1cnJpY2FsaWduJTJGZnJvbnRlbmQlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGc3RhbCUyRkRvY3VtZW50cyUyRlByb2plY3RzJTJGY3VycmljYWxpZ24lMkZmcm9udGVuZCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCZpc0dsb2JhbE5vdEZvdW5kRW5hYmxlZD0hIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ3FCO0FBQ2Q7QUFDUztBQUNPO0FBQ0s7QUFDbUM7QUFDakQ7QUFDTztBQUNmO0FBQ3NDO0FBQ3pCO0FBQ007QUFDQztBQUNoQjtBQUN5QztBQUMzRztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxhQUFhLE9BQW9DLElBQUksQ0FBRTtBQUN2RCxnQkFBZ0IsTUFBdUM7QUFDdkQ7QUFDQTtBQUNBLFlBQVk7QUFD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LGtCQUFrQiw2RUFBWTtBQUM5QjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDViw2RUFBNkUsZ0ZBQWM7QUFDM0YsaUNBQWlDLFFBQVEsRUFBRSxRQUFRO0FBQ25ELDBCQUEwQix1RUFBUTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLE1BQU07QUFDTjtBQUNBLDRDQUE0Qyw2RkFBZTtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQywyRkFBbUI7QUFDckQ7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsNkVBQVk7QUFDMUI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0IHsgZ2V0UmVxdWVzdE1ldGEgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yZXF1ZXN0LW1ldGFcIjtcbmltcG9ydCB7IGdldFRyYWNlciwgU3BhbktpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvdHJhY2UvdHJhY2VyXCI7XG5pbXBvcnQgeyBub3JtYWxpemVBcHBQYXRoIH0gZnJvbSBcIm5leHQvZGlzdC9zaGFyZWQvbGliL3JvdXRlci91dGlscy9hcHAtcGF0aHNcIjtcbmltcG9ydCB7IE5vZGVOZXh0UmVxdWVzdCwgTm9kZU5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Jhc2UtaHR0cC9ub2RlXCI7XG5pbXBvcnQgeyBOZXh0UmVxdWVzdEFkYXB0ZXIsIHNpZ25hbEZyb21Ob2RlUmVzcG9uc2UgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci93ZWIvc3BlYy1leHRlbnNpb24vYWRhcHRlcnMvbmV4dC1yZXF1ZXN0XCI7XG5pbXBvcnQgeyBCYXNlU2VydmVyU3BhbiB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS9jb25zdGFudHNcIjtcbmltcG9ydCB7IGdldFJldmFsaWRhdGVSZWFzb24gfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9pbnN0cnVtZW50YXRpb24vdXRpbHNcIjtcbmltcG9ydCB7IHNlbmRSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3NlbmQtcmVzcG9uc2VcIjtcbmltcG9ydCB7IGZyb21Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycywgdG9Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycyB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3dlYi91dGlsc1wiO1xuaW1wb3J0IHsgZ2V0Q2FjaGVDb250cm9sSGVhZGVyIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL2NhY2hlLWNvbnRyb2xcIjtcbmltcG9ydCB7IElORklOSVRFX0NBQ0hFLCBORVhUX0NBQ0hFX1RBR1NfSEVBREVSIH0gZnJvbSBcIm5leHQvZGlzdC9saWIvY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBOb0ZhbGxiYWNrRXJyb3IgfSBmcm9tIFwibmV4dC9kaXN0L3NoYXJlZC9saWIvbm8tZmFsbGJhY2stZXJyb3IuZXh0ZXJuYWxcIjtcbmltcG9ydCB7IENhY2hlZFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3Jlc3BvbnNlLWNhY2hlXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL3N0YWwvRG9jdW1lbnRzL1Byb2plY3RzL2N1cnJpY2FsaWduL2Zyb250ZW5kL3NyYy9hcHAvYXBpL2Nhcmx5L3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jYXJseS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2Nhcmx5XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9jYXJseS9yb3V0ZVwiXG4gICAgfSxcbiAgICBkaXN0RGlyOiBwcm9jZXNzLmVudi5fX05FWFRfUkVMQVRJVkVfRElTVF9ESVIgfHwgJycsXG4gICAgcHJvamVjdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX1BST0pFQ1RfRElSIHx8ICcnLFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL3N0YWwvRG9jdW1lbnRzL1Byb2plY3RzL2N1cnJpY2FsaWduL2Zyb250ZW5kL3NyYy9hcHAvYXBpL2Nhcmx5L3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMsIGN0eCkge1xuICAgIHZhciBfbmV4dENvbmZpZ19leHBlcmltZW50YWw7XG4gICAgbGV0IHNyY1BhZ2UgPSBcIi9hcGkvY2FybHkvcm91dGVcIjtcbiAgICAvLyB0dXJib3BhY2sgZG9lc24ndCBub3JtYWxpemUgYC9pbmRleGAgaW4gdGhlIHBhZ2UgbmFtZVxuICAgIC8vIHNvIHdlIG5lZWQgdG8gdG8gcHJvY2VzcyBkeW5hbWljIHJvdXRlcyBwcm9wZXJseVxuICAgIC8vIFRPRE86IGZpeCB0dXJib3BhY2sgcHJvdmlkaW5nIGRpZmZlcmluZyB2YWx1ZSBmcm9tIHdlYnBhY2tcbiAgICBpZiAocHJvY2Vzcy5lbnYuVFVSQk9QQUNLKSB7XG4gICAgICAgIHNyY1BhZ2UgPSBzcmNQYWdlLnJlcGxhY2UoL1xcL2luZGV4JC8sICcnKSB8fCAnLyc7XG4gICAgfSBlbHNlIGlmIChzcmNQYWdlID09PSAnL2luZGV4Jykge1xuICAgICAgICAvLyB3ZSBhbHdheXMgbm9ybWFsaXplIC9pbmRleCBzcGVjaWZpY2FsbHlcbiAgICAgICAgc3JjUGFnZSA9ICcvJztcbiAgICB9XG4gICAgY29uc3QgbXVsdGlab25lRHJhZnRNb2RlID0gcHJvY2Vzcy5lbnYuX19ORVhUX01VTFRJX1pPTkVfRFJBRlRfTU9ERTtcbiAgICBjb25zdCBwcmVwYXJlUmVzdWx0ID0gYXdhaXQgcm91dGVNb2R1bGUucHJlcGFyZShyZXEsIHJlcywge1xuICAgICAgICBzcmNQYWdlLFxuICAgICAgICBtdWx0aVpvbmVEcmFmdE1vZGVcbiAgICB9KTtcbiAgICBpZiAoIXByZXBhcmVSZXN1bHQpIHtcbiAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSA0MDA7XG4gICAgICAgIHJlcy5lbmQoJ0JhZCBSZXF1ZXN0Jyk7XG4gICAgICAgIGN0eC53YWl0VW50aWwgPT0gbnVsbCA/IHZvaWQgMCA6IGN0eC53YWl0VW50aWwuY2FsbChjdHgsIFByb21pc2UucmVzb2x2ZSgpKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHsgYnVpbGRJZCwgcGFyYW1zLCBuZXh0Q29uZmlnLCBpc0RyYWZ0TW9kZSwgcHJlcmVuZGVyTWFuaWZlc3QsIHJvdXRlclNlcnZlckNvbnRleHQsIGlzT25EZW1hbmRSZXZhbGlkYXRlLCByZXZhbGlkYXRlT25seUdlbmVyYXRlZCwgcmVzb2x2ZWRQYXRobmFtZSB9ID0gcHJlcGFyZVJlc3VsdDtcbiAgICBjb25zdCBub3JtYWxpemVkU3JjUGFnZSA9IG5vcm1hbGl6ZUFwcFBhdGgoc3JjUGFnZSk7XG4gICAgbGV0IGlzSXNyID0gQm9vbGVhbihwcmVyZW5kZXJNYW5pZmVzdC5keW5hbWljUm91dGVzW25vcm1hbGl6ZWRTcmNQYWdlXSB8fCBwcmVyZW5kZXJNYW5pZmVzdC5yb3V0ZXNbcmVzb2x2ZWRQYXRobmFtZV0pO1xuICAgIGlmIChpc0lzciAmJiAhaXNEcmFmdE1vZGUpIHtcbiAgICAgICAgY29uc3QgaXNQcmVyZW5kZXJlZCA9IEJvb2xlYW4ocHJlcmVuZGVyTWFuaWZlc3Qucm91dGVzW3Jlc29sdmVkUGF0aG5hbWVdKTtcbiAgICAgICAgY29uc3QgcHJlcmVuZGVySW5mbyA9IHByZXJlbmRlck1hbmlmZXN0LmR5bmFtaWNSb3V0ZXNbbm9ybWFsaXplZFNyY1BhZ2VdO1xuICAgICAgICBpZiAocHJlcmVuZGVySW5mbykge1xuICAgICAgICAgICAgaWYgKHByZXJlbmRlckluZm8uZmFsbGJhY2sgPT09IGZhbHNlICYmICFpc1ByZXJlbmRlcmVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vRmFsbGJhY2tFcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGxldCBjYWNoZUtleSA9IG51bGw7XG4gICAgaWYgKGlzSXNyICYmICFyb3V0ZU1vZHVsZS5pc0RldiAmJiAhaXNEcmFmdE1vZGUpIHtcbiAgICAgICAgY2FjaGVLZXkgPSByZXNvbHZlZFBhdGhuYW1lO1xuICAgICAgICAvLyBlbnN1cmUgL2luZGV4IGFuZCAvIGlzIG5vcm1hbGl6ZWQgdG8gb25lIGtleVxuICAgICAgICBjYWNoZUtleSA9IGNhY2hlS2V5ID09PSAnL2luZGV4JyA/ICcvJyA6IGNhY2hlS2V5O1xuICAgIH1cbiAgICBjb25zdCBzdXBwb3J0c0R5bmFtaWNSZXNwb25zZSA9IC8vIElmIHdlJ3JlIGluIGRldmVsb3BtZW50LCB3ZSBhbHdheXMgc3VwcG9ydCBkeW5hbWljIEhUTUxcbiAgICByb3V0ZU1vZHVsZS5pc0RldiA9PT0gdHJ1ZSB8fCAvLyBJZiB0aGlzIGlzIG5vdCBTU0cgb3IgZG9lcyBub3QgaGF2ZSBzdGF0aWMgcGF0aHMsIHRoZW4gaXQgc3VwcG9ydHNcbiAgICAvLyBkeW5hbWljIEhUTUwuXG4gICAgIWlzSXNyO1xuICAgIC8vIFRoaXMgaXMgYSByZXZhbGlkYXRpb24gcmVxdWVzdCBpZiB0aGUgcmVxdWVzdCBpcyBmb3IgYSBzdGF0aWNcbiAgICAvLyBwYWdlIGFuZCBpdCBpcyBub3QgYmVpbmcgcmVzdW1lZCBmcm9tIGEgcG9zdHBvbmVkIHJlbmRlciBhbmRcbiAgICAvLyBpdCBpcyBub3QgYSBkeW5hbWljIFJTQyByZXF1ZXN0IHRoZW4gaXQgaXMgYSByZXZhbGlkYXRpb25cbiAgICAvLyByZXF1ZXN0LlxuICAgIGNvbnN0IGlzUmV2YWxpZGF0ZSA9IGlzSXNyICYmICFzdXBwb3J0c0R5bmFtaWNSZXNwb25zZTtcbiAgICBjb25zdCBtZXRob2QgPSByZXEubWV0aG9kIHx8ICdHRVQnO1xuICAgIGNvbnN0IHRyYWNlciA9IGdldFRyYWNlcigpO1xuICAgIGNvbnN0IGFjdGl2ZVNwYW4gPSB0cmFjZXIuZ2V0QWN0aXZlU2NvcGVTcGFuKCk7XG4gICAgY29uc3QgY29udGV4dCA9IHtcbiAgICAgICAgcGFyYW1zLFxuICAgICAgICBwcmVyZW5kZXJNYW5pZmVzdCxcbiAgICAgICAgcmVuZGVyT3B0czoge1xuICAgICAgICAgICAgZXhwZXJpbWVudGFsOiB7XG4gICAgICAgICAgICAgICAgZHluYW1pY0lPOiBCb29sZWFuKG5leHRDb25maWcuZXhwZXJpbWVudGFsLmR5bmFtaWNJTyksXG4gICAgICAgICAgICAgICAgYXV0aEludGVycnVwdHM6IEJvb2xlYW4obmV4dENvbmZpZy5leHBlcmltZW50YWwuYXV0aEludGVycnVwdHMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VwcG9ydHNEeW5hbWljUmVzcG9uc2UsXG4gICAgICAgICAgICBpbmNyZW1lbnRhbENhY2hlOiBnZXRSZXF1ZXN0TWV0YShyZXEsICdpbmNyZW1lbnRhbENhY2hlJyksXG4gICAgICAgICAgICBjYWNoZUxpZmVQcm9maWxlczogKF9uZXh0Q29uZmlnX2V4cGVyaW1lbnRhbCA9IG5leHRDb25maWcuZXhwZXJpbWVudGFsKSA9PSBudWxsID8gdm9pZCAwIDogX25leHRDb25maWdfZXhwZXJpbWVudGFsLmNhY2hlTGlmZSxcbiAgICAgICAgICAgIGlzUmV2YWxpZGF0ZSxcbiAgICAgICAgICAgIHdhaXRVbnRpbDogY3R4LndhaXRVbnRpbCxcbiAgICAgICAgICAgIG9uQ2xvc2U6IChjYik9PntcbiAgICAgICAgICAgICAgICByZXMub24oJ2Nsb3NlJywgY2IpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQWZ0ZXJUYXNrRXJyb3I6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG9uSW5zdHJ1bWVudGF0aW9uUmVxdWVzdEVycm9yOiAoZXJyb3IsIF9yZXF1ZXN0LCBlcnJvckNvbnRleHQpPT5yb3V0ZU1vZHVsZS5vblJlcXVlc3RFcnJvcihyZXEsIGVycm9yLCBlcnJvckNvbnRleHQsIHJvdXRlclNlcnZlckNvbnRleHQpXG4gICAgICAgIH0sXG4gICAgICAgIHNoYXJlZENvbnRleHQ6IHtcbiAgICAgICAgICAgIGJ1aWxkSWRcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgbm9kZU5leHRSZXEgPSBuZXcgTm9kZU5leHRSZXF1ZXN0KHJlcSk7XG4gICAgY29uc3Qgbm9kZU5leHRSZXMgPSBuZXcgTm9kZU5leHRSZXNwb25zZShyZXMpO1xuICAgIGNvbnN0IG5leHRSZXEgPSBOZXh0UmVxdWVzdEFkYXB0ZXIuZnJvbU5vZGVOZXh0UmVxdWVzdChub2RlTmV4dFJlcSwgc2lnbmFsRnJvbU5vZGVSZXNwb25zZShyZXMpKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBpbnZva2VSb3V0ZU1vZHVsZSA9IGFzeW5jIChzcGFuKT0+e1xuICAgICAgICAgICAgcmV0dXJuIHJvdXRlTW9kdWxlLmhhbmRsZShuZXh0UmVxLCBjb250ZXh0KS5maW5hbGx5KCgpPT57XG4gICAgICAgICAgICAgICAgaWYgKCFzcGFuKSByZXR1cm47XG4gICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgJ2h0dHAuc3RhdHVzX2NvZGUnOiByZXMuc3RhdHVzQ29kZSxcbiAgICAgICAgICAgICAgICAgICAgJ25leHQucnNjJzogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCByb290U3BhbkF0dHJpYnV0ZXMgPSB0cmFjZXIuZ2V0Um9vdFNwYW5BdHRyaWJ1dGVzKCk7XG4gICAgICAgICAgICAgICAgLy8gV2Ugd2VyZSB1bmFibGUgdG8gZ2V0IGF0dHJpYnV0ZXMsIHByb2JhYmx5IE9URUwgaXMgbm90IGVuYWJsZWRcbiAgICAgICAgICAgICAgICBpZiAoIXJvb3RTcGFuQXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnNwYW5fdHlwZScpICE9PSBCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVW5leHBlY3RlZCByb290IHNwYW4gdHlwZSAnJHtyb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnNwYW5fdHlwZScpfScuIFBsZWFzZSByZXBvcnQgdGhpcyBOZXh0LmpzIGlzc3VlIGh0dHBzOi8vZ2l0aHViLmNvbS92ZXJjZWwvbmV4dC5qc2ApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gcm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5yb3V0ZScpO1xuICAgICAgICAgICAgICAgIGlmIChyb3V0ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYCR7bWV0aG9kfSAke3JvdXRlfWA7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5yb3V0ZSc6IHJvdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0LnNwYW5fbmFtZSc6IG5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4udXBkYXRlTmFtZShuYW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUoYCR7bWV0aG9kfSAke3JlcS51cmx9YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGhhbmRsZVJlc3BvbnNlID0gYXN5bmMgKGN1cnJlbnRTcGFuKT0+e1xuICAgICAgICAgICAgdmFyIF9jYWNoZUVudHJ5X3ZhbHVlO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VHZW5lcmF0b3IgPSBhc3luYyAoeyBwcmV2aW91c0NhY2hlRW50cnkgfSk9PntcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWdldFJlcXVlc3RNZXRhKHJlcSwgJ21pbmltYWxNb2RlJykgJiYgaXNPbkRlbWFuZFJldmFsaWRhdGUgJiYgcmV2YWxpZGF0ZU9ubHlHZW5lcmF0ZWQgJiYgIXByZXZpb3VzQ2FjaGVFbnRyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSA0MDQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvbi1kZW1hbmQgcmV2YWxpZGF0ZSBhbHdheXMgc2V0cyB0aGlzIGhlYWRlclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcigneC1uZXh0anMtY2FjaGUnLCAnUkVWQUxJREFURUQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5lbmQoJ1RoaXMgcGFnZSBjb3VsZCBub3QgYmUgZm91bmQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaW52b2tlUm91dGVNb2R1bGUoY3VycmVudFNwYW4pO1xuICAgICAgICAgICAgICAgICAgICByZXEuZmV0Y2hNZXRyaWNzID0gY29udGV4dC5yZW5kZXJPcHRzLmZldGNoTWV0cmljcztcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBlbmRpbmdXYWl0VW50aWwgPSBjb250ZXh0LnJlbmRlck9wdHMucGVuZGluZ1dhaXRVbnRpbDtcbiAgICAgICAgICAgICAgICAgICAgLy8gQXR0ZW1wdCB1c2luZyBwcm92aWRlZCB3YWl0VW50aWwgaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIGl0J3Mgbm90IHdlIGZhbGxiYWNrIHRvIHNlbmRSZXNwb25zZSdzIGhhbmRsaW5nXG4gICAgICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nV2FpdFVudGlsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3R4LndhaXRVbnRpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC53YWl0VW50aWwocGVuZGluZ1dhaXRVbnRpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ1dhaXRVbnRpbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZVRhZ3MgPSBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkVGFncztcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJlcXVlc3QgaXMgZm9yIGEgc3RhdGljIHJlc3BvbnNlLCB3ZSBjYW4gY2FjaGUgaXQgc28gbG9uZ1xuICAgICAgICAgICAgICAgICAgICAvLyBhcyBpdCdzIG5vdCBlZGdlLlxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNJc3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCByZXNwb25zZS5ibG9iKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3B5IHRoZSBoZWFkZXJzIGZyb20gdGhlIHJlc3BvbnNlLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IHRvTm9kZU91dGdvaW5nSHR0cEhlYWRlcnMocmVzcG9uc2UuaGVhZGVycyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FjaGVUYWdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1tORVhUX0NBQ0hFX1RBR1NfSEVBREVSXSA9IGNhY2hlVGFncztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGVhZGVyc1snY29udGVudC10eXBlJ10gJiYgYmxvYi50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1snY29udGVudC10eXBlJ10gPSBibG9iLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXZhbGlkYXRlID0gdHlwZW9mIGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRSZXZhbGlkYXRlID09PSAndW5kZWZpbmVkJyB8fCBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkUmV2YWxpZGF0ZSA+PSBJTkZJTklURV9DQUNIRSA/IGZhbHNlIDogY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZFJldmFsaWRhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBpcmUgPSB0eXBlb2YgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZEV4cGlyZSA9PT0gJ3VuZGVmaW5lZCcgfHwgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZEV4cGlyZSA+PSBJTkZJTklURV9DQUNIRSA/IHVuZGVmaW5lZCA6IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRFeHBpcmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGNhY2hlIGVudHJ5IGZvciB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZUVudHJ5ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ6IENhY2hlZFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiBCdWZmZXIuZnJvbShhd2FpdCBibG9iLmFycmF5QnVmZmVyKCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZUNvbnRyb2w6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWNoZUVudHJ5O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VuZCByZXNwb25zZSB3aXRob3V0IGNhY2hpbmcgaWYgbm90IElTUlxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZFJlc3BvbnNlKG5vZGVOZXh0UmVxLCBub2RlTmV4dFJlcywgcmVzcG9uc2UsIGNvbnRleHQucmVuZGVyT3B0cy5wZW5kaW5nV2FpdFVudGlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBiYWNrZ3JvdW5kIHJldmFsaWRhdGUgd2UgbmVlZCB0byByZXBvcnRcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHJlcXVlc3QgZXJyb3IgaGVyZSBhcyBpdCB3b24ndCBiZSBidWJibGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c0NhY2hlRW50cnkgPT0gbnVsbCA/IHZvaWQgMCA6IHByZXZpb3VzQ2FjaGVFbnRyeS5pc1N0YWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCByb3V0ZU1vZHVsZS5vblJlcXVlc3RFcnJvcihyZXEsIGVyciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcktpbmQ6ICdBcHAgUm91dGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZVBhdGg6IHNyY1BhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVUeXBlOiAncm91dGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGVSZWFzb246IGdldFJldmFsaWRhdGVSZWFzb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJvdXRlclNlcnZlckNvbnRleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgY2FjaGVFbnRyeSA9IGF3YWl0IHJvdXRlTW9kdWxlLmhhbmRsZVJlc3BvbnNlKHtcbiAgICAgICAgICAgICAgICByZXEsXG4gICAgICAgICAgICAgICAgbmV4dENvbmZpZyxcbiAgICAgICAgICAgICAgICBjYWNoZUtleSxcbiAgICAgICAgICAgICAgICByb3V0ZUtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgICAgICAgICAgaXNGYWxsYmFjazogZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJlcmVuZGVyTWFuaWZlc3QsXG4gICAgICAgICAgICAgICAgaXNSb3V0ZVBQUkVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgIHJldmFsaWRhdGVPbmx5R2VuZXJhdGVkLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlR2VuZXJhdG9yLFxuICAgICAgICAgICAgICAgIHdhaXRVbnRpbDogY3R4LndhaXRVbnRpbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyB3ZSBkb24ndCBjcmVhdGUgYSBjYWNoZUVudHJ5IGZvciBJU1JcbiAgICAgICAgICAgIGlmICghaXNJc3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgoY2FjaGVFbnRyeSA9PSBudWxsID8gdm9pZCAwIDogKF9jYWNoZUVudHJ5X3ZhbHVlID0gY2FjaGVFbnRyeS52YWx1ZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9jYWNoZUVudHJ5X3ZhbHVlLmtpbmQpICE9PSBDYWNoZWRSb3V0ZUtpbmQuQVBQX1JPVVRFKSB7XG4gICAgICAgICAgICAgICAgdmFyIF9jYWNoZUVudHJ5X3ZhbHVlMTtcbiAgICAgICAgICAgICAgICB0aHJvdyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3IEVycm9yKGBJbnZhcmlhbnQ6IGFwcC1yb3V0ZSByZWNlaXZlZCBpbnZhbGlkIGNhY2hlIGVudHJ5ICR7Y2FjaGVFbnRyeSA9PSBudWxsID8gdm9pZCAwIDogKF9jYWNoZUVudHJ5X3ZhbHVlMSA9IGNhY2hlRW50cnkudmFsdWUpID09IG51bGwgPyB2b2lkIDAgOiBfY2FjaGVFbnRyeV92YWx1ZTEua2luZH1gKSwgXCJfX05FWFRfRVJST1JfQ09ERVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcIkU3MDFcIixcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFnZXRSZXF1ZXN0TWV0YShyZXEsICdtaW5pbWFsTW9kZScpKSB7XG4gICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcigneC1uZXh0anMtY2FjaGUnLCBpc09uRGVtYW5kUmV2YWxpZGF0ZSA/ICdSRVZBTElEQVRFRCcgOiBjYWNoZUVudHJ5LmlzTWlzcyA/ICdNSVNTJyA6IGNhY2hlRW50cnkuaXNTdGFsZSA/ICdTVEFMRScgOiAnSElUJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBEcmFmdCBtb2RlIHNob3VsZCBuZXZlciBiZSBjYWNoZWRcbiAgICAgICAgICAgIGlmIChpc0RyYWZ0TW9kZSkge1xuICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAncHJpdmF0ZSwgbm8tY2FjaGUsIG5vLXN0b3JlLCBtYXgtYWdlPTAsIG11c3QtcmV2YWxpZGF0ZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IGZyb21Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycyhjYWNoZUVudHJ5LnZhbHVlLmhlYWRlcnMpO1xuICAgICAgICAgICAgaWYgKCEoZ2V0UmVxdWVzdE1ldGEocmVxLCAnbWluaW1hbE1vZGUnKSAmJiBpc0lzcikpIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzLmRlbGV0ZShORVhUX0NBQ0hFX1RBR1NfSEVBREVSKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIGNhY2hlIGNvbnRyb2wgaXMgYWxyZWFkeSBzZXQgb24gdGhlIHJlc3BvbnNlIHdlIGRvbid0XG4gICAgICAgICAgICAvLyBvdmVycmlkZSBpdCB0byBhbGxvdyB1c2VycyB0byBjdXN0b21pemUgaXQgdmlhIG5leHQuY29uZmlnXG4gICAgICAgICAgICBpZiAoY2FjaGVFbnRyeS5jYWNoZUNvbnRyb2wgJiYgIXJlcy5nZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnKSAmJiAhaGVhZGVycy5nZXQoJ0NhY2hlLUNvbnRyb2wnKSkge1xuICAgICAgICAgICAgICAgIGhlYWRlcnMuc2V0KCdDYWNoZS1Db250cm9sJywgZ2V0Q2FjaGVDb250cm9sSGVhZGVyKGNhY2hlRW50cnkuY2FjaGVDb250cm9sKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCBzZW5kUmVzcG9uc2Uobm9kZU5leHRSZXEsIG5vZGVOZXh0UmVzLCBuZXcgUmVzcG9uc2UoY2FjaGVFbnRyeS52YWx1ZS5ib2R5LCB7XG4gICAgICAgICAgICAgICAgaGVhZGVycyxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGNhY2hlRW50cnkudmFsdWUuc3RhdHVzIHx8IDIwMFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH07XG4gICAgICAgIC8vIFRPRE86IGFjdGl2ZVNwYW4gY29kZSBwYXRoIGlzIGZvciB3aGVuIHdyYXBwZWQgYnlcbiAgICAgICAgLy8gbmV4dC1zZXJ2ZXIgY2FuIGJlIHJlbW92ZWQgd2hlbiB0aGlzIGlzIG5vIGxvbmdlciB1c2VkXG4gICAgICAgIGlmIChhY3RpdmVTcGFuKSB7XG4gICAgICAgICAgICBhd2FpdCBoYW5kbGVSZXNwb25zZShhY3RpdmVTcGFuKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGF3YWl0IHRyYWNlci53aXRoUHJvcGFnYXRlZENvbnRleHQocmVxLmhlYWRlcnMsICgpPT50cmFjZXIudHJhY2UoQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCwge1xuICAgICAgICAgICAgICAgICAgICBzcGFuTmFtZTogYCR7bWV0aG9kfSAke3JlcS51cmx9YCxcbiAgICAgICAgICAgICAgICAgICAga2luZDogU3BhbktpbmQuU0VSVkVSLFxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC5tZXRob2QnOiBtZXRob2QsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC50YXJnZXQnOiByZXEudXJsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBoYW5kbGVSZXNwb25zZSkpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIGlmIHdlIGFyZW4ndCB3cmFwcGVkIGJ5IGJhc2Utc2VydmVyIGhhbmRsZSBoZXJlXG4gICAgICAgIGlmICghYWN0aXZlU3BhbiAmJiAhKGVyciBpbnN0YW5jZW9mIE5vRmFsbGJhY2tFcnJvcikpIHtcbiAgICAgICAgICAgIGF3YWl0IHJvdXRlTW9kdWxlLm9uUmVxdWVzdEVycm9yKHJlcSwgZXJyLCB7XG4gICAgICAgICAgICAgICAgcm91dGVyS2luZDogJ0FwcCBSb3V0ZXInLFxuICAgICAgICAgICAgICAgIHJvdXRlUGF0aDogbm9ybWFsaXplZFNyY1BhZ2UsXG4gICAgICAgICAgICAgICAgcm91dGVUeXBlOiAncm91dGUnLFxuICAgICAgICAgICAgICAgIHJldmFsaWRhdGVSZWFzb246IGdldFJldmFsaWRhdGVSZWFzb24oe1xuICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGUsXG4gICAgICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJldGhyb3cgc28gdGhhdCB3ZSBjYW4gaGFuZGxlIHNlcnZpbmcgZXJyb3IgcGFnZVxuICAgICAgICAvLyBJZiB0aGlzIGlzIGR1cmluZyBzdGF0aWMgZ2VuZXJhdGlvbiwgdGhyb3cgdGhlIGVycm9yIGFnYWluLlxuICAgICAgICBpZiAoaXNJc3IpIHRocm93IGVycjtcbiAgICAgICAgLy8gT3RoZXJ3aXNlLCBzZW5kIGEgNTAwIHJlc3BvbnNlLlxuICAgICAgICBhd2FpdCBzZW5kUmVzcG9uc2Uobm9kZU5leHRSZXEsIG5vZGVOZXh0UmVzLCBuZXcgUmVzcG9uc2UobnVsbCwge1xuICAgICAgICAgICAgc3RhdHVzOiA1MDBcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fcarly%2Froute&page=%2Fapi%2Fcarly%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcarly%2Froute.ts&appDir=%2FUsers%2Fstal%2FDocuments%2FProjects%2Fcurricalign%2Ffrontend%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fstal%2FDocuments%2FProjects%2Fcurricalign%2Ffrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/carly/db.ts":
/*!*********************************!*\
  !*** ./src/app/api/carly/db.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TABLES: () => (/* binding */ TABLES),\n/* harmony export */   dbSelectOptimized: () => (/* binding */ dbSelectOptimized)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zod */ \"(rsc)/../node_modules/zod/v4/classic/schemas.js\");\n// api/carly/db.ts\n\n\n// ---------------- Config: whitelist + token-guardrails ----------------\nconst TABLES = {\n    jobs: [\n        'id',\n        'title',\n        'created_at',\n        'updated_at'\n    ],\n    job_skills: [\n        'job_id',\n        'skill',\n        'created_at'\n    ],\n    courses: [\n        'id',\n        'title',\n        'code',\n        'updated_at'\n    ],\n    course_skills: [\n        'course_id',\n        'skill'\n    ],\n    course_alignment_scores: [\n        'course_id',\n        'score',\n        'calculated_at'\n    ]\n};\n// Hard caps to protect tokens\nconst MAX_ROWS_HARD = 50; // never fetch more than this\nconst MAX_COLS_HARD = 8; // never return more than this many columns\nconst DEFAULT_LIMIT = 25; // soft cap unless user asks for more\nconst DEFAULT_SAMPLE = 8; // number of rows to include in the sample\nconst MAX_CELL_LEN = 80; // trim long strings so the tool response stays small\nconst TOP_VALUES_PER_COL = 5; // summarize categorical columns by top N values\nfunction getSupaReadOnly() {\n    const url = \"https://swiuodmiiuqausjombgm.supabase.co\";\n    const key = process.env.SUPABASE_SERVICE_ROLE_KEY; // server-only\n    if (!url) throw new Error('Missing env: NEXT_PUBLIC_SUPABASE_URL');\n    if (!key) throw new Error('Missing env: SUPABASE_SERVICE_ROLE_KEY');\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, key, {\n        auth: {\n            persistSession: false\n        }\n    });\n}\nconst DbSelectSchema = zod__WEBPACK_IMPORTED_MODULE_1__.object({\n    table: zod__WEBPACK_IMPORTED_MODULE_1__.string(),\n    columns: zod__WEBPACK_IMPORTED_MODULE_1__.array(zod__WEBPACK_IMPORTED_MODULE_1__.string()).optional(),\n    eq: zod__WEBPACK_IMPORTED_MODULE_1__.record(zod__WEBPACK_IMPORTED_MODULE_1__.string(), zod__WEBPACK_IMPORTED_MODULE_1__.string().or(zod__WEBPACK_IMPORTED_MODULE_1__.number())).optional(),\n    ilike: zod__WEBPACK_IMPORTED_MODULE_1__.record(zod__WEBPACK_IMPORTED_MODULE_1__.string(), zod__WEBPACK_IMPORTED_MODULE_1__.string()).optional(),\n    gte: zod__WEBPACK_IMPORTED_MODULE_1__.record(zod__WEBPACK_IMPORTED_MODULE_1__.string(), zod__WEBPACK_IMPORTED_MODULE_1__.string().or(zod__WEBPACK_IMPORTED_MODULE_1__.number())).optional(),\n    lte: zod__WEBPACK_IMPORTED_MODULE_1__.record(zod__WEBPACK_IMPORTED_MODULE_1__.string(), zod__WEBPACK_IMPORTED_MODULE_1__.string().or(zod__WEBPACK_IMPORTED_MODULE_1__.number())).optional(),\n    orderBy: zod__WEBPACK_IMPORTED_MODULE_1__.string().optional(),\n    desc: zod__WEBPACK_IMPORTED_MODULE_1__.boolean().optional(),\n    limit: zod__WEBPACK_IMPORTED_MODULE_1__.number().min(1).max(MAX_ROWS_HARD).optional(),\n    offset: zod__WEBPACK_IMPORTED_MODULE_1__.number().min(0).max(5000).optional(),\n    // token optimization knobs\n    sampleSize: zod__WEBPACK_IMPORTED_MODULE_1__.number().min(0).max(DEFAULT_LIMIT).optional(),\n    mode: zod__WEBPACK_IMPORTED_MODULE_1__[\"enum\"]([\n        'summary',\n        'rows'\n    ]).optional()\n});\n// --------------- helpers ---------------\nconst trimCell = (v)=>{\n    if (v == null) return v;\n    const s = String(v);\n    return s.length > MAX_CELL_LEN ? s.slice(0, MAX_CELL_LEN - 1) + '' : s;\n};\nconst pickAllowedColumns = (table, requested)=>{\n    const allowed = TABLES[table] ?? [];\n    const cols = (requested && requested.length ? requested : allowed).filter((c)=>allowed.includes(c));\n    return cols.slice(0, MAX_COLS_HARD);\n};\n// --------------- main ---------------\nasync function dbSelectOptimized(raw) {\n    const args = DbSelectSchema.parse(raw);\n    const allowedCols = TABLES[args.table];\n    if (!allowedCols) {\n        return {\n            ok: false,\n            error: `Table \"${args.table}\" not allowed`\n        };\n    }\n    // columns & limits\n    const cols = pickAllowedColumns(args.table, args.columns);\n    if (!cols.length) return {\n        ok: false,\n        error: 'No allowed columns requested'\n    };\n    const limit = Math.min(args.limit ?? DEFAULT_LIMIT, MAX_ROWS_HARD);\n    const sampleSize = Math.min(args.sampleSize ?? DEFAULT_SAMPLE, limit);\n    const supa = getSupaReadOnly();\n    let q = supa.from(args.table).select(cols.join(','));\n    // filters\n    for (const group of [\n        'eq',\n        'ilike',\n        'gte',\n        'lte'\n    ]){\n        const rec = args[group];\n        if (!rec) continue;\n        for (const [k, v] of Object.entries(rec)){\n            if (!cols.includes(k) && !allowedCols.includes(k)) continue;\n            switch(group){\n                case 'eq':\n                    q = q.eq(k, v);\n                    break;\n                case 'ilike':\n                    q = q.ilike(k, v);\n                    break;\n                case 'gte':\n                    q = q.gte(k, v);\n                    break;\n                case 'lte':\n                    q = q.lte(k, v);\n                    break;\n            }\n        }\n    }\n    // order / pagination\n    if (args.orderBy && (cols.includes(args.orderBy) || allowedCols.includes(args.orderBy))) {\n        q = q.order(args.orderBy, {\n            ascending: !args.desc\n        });\n    }\n    if (args.offset) q = q.range(args.offset, args.offset + limit - 1);\n    else q = q.limit(limit);\n    const res = await q;\n    if (res.error) return {\n        ok: false,\n        error: res.error.message\n    };\n    const items = res.data ?? [];\n    // ---------- build compact summary ----------\n    const summary = {\n        rowCount: items.length,\n        columns: cols\n    };\n    // simple value counts for categorical-ish columns (strings)\n    for (const col of cols){\n        // collect frequency if column looks categorical (string, short)\n        const freq = new Map();\n        let stringy = 0;\n        for (const r of items){\n            const v = r[col];\n            if (typeof v === 'string') {\n                stringy++;\n                const key = trimCell(v);\n                freq.set(key, (freq.get(key) ?? 0) + 1);\n            }\n        }\n        if (stringy && freq.size) {\n            const top = [\n                ...freq.entries()\n            ].sort((a, b)=>b[1] - a[1]).slice(0, TOP_VALUES_PER_COL).map(([value, count])=>({\n                    value,\n                    count\n                }));\n            summary[col] = {\n                topValues: top,\n                distinct: freq.size\n            };\n        }\n    }\n    // numeric aggregates\n    for (const col of cols){\n        const nums = items.map((r)=>Number(r[col])).filter((n)=>Number.isFinite(n));\n        if (nums.length >= 3) {\n            const min = Math.min(...nums);\n            const max = Math.max(...nums);\n            const avg = nums.reduce((a, b)=>a + b, 0) / nums.length;\n            summary[col] = {\n                ...summary[col] || {},\n                stats: {\n                    min,\n                    max,\n                    avg: Number(avg.toFixed(3)),\n                    n: nums.length\n                }\n            };\n        }\n    }\n    // small sample of rows (trimmed)\n    const sampleRows = items.slice(0, sampleSize).map((r)=>{\n        const obj = {};\n        for (const c of cols)obj[c] = trimCell(r[c]);\n        return obj;\n    });\n    // 'rows' mode returns only a small trimmed row set (still token-safe)\n    if (args.mode === 'rows') {\n        return {\n            ok: true,\n            mode: 'rows',\n            table: args.table,\n            returned: sampleRows.length,\n            limitApplied: limit,\n            columns: cols,\n            rows: sampleRows,\n            note: `Trimmed to ${sampleRows.length} rows, ${cols.length} cols. Cells > ${MAX_CELL_LEN} chars truncated.`\n        };\n    }\n    // default: 'summary' mode\n    return {\n        ok: true,\n        mode: 'summary',\n        table: args.table,\n        limitApplied: limit,\n        columns: cols,\n        sample: sampleRows,\n        summary,\n        note: `Summary with ${sampleRows.length} sample rows. Cells > ${MAX_CELL_LEN} chars truncated.`\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c2Vycy9zdGFsL0RvY3VtZW50cy9Qcm9qZWN0cy9jdXJyaWNhbGlnbi9mcm9udGVuZC9zcmMvYXBwL2FwaS9jYXJseS9kYi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBhcGkvY2FybHkvZGIudHNcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuLy8gLS0tLS0tLS0tLS0tLS0tLSBDb25maWc6IHdoaXRlbGlzdCArIHRva2VuLWd1YXJkcmFpbHMgLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGNvbnN0IFRBQkxFUzogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICBqb2JzOiBbJ2lkJywgJ3RpdGxlJywgJ2NyZWF0ZWRfYXQnLCAndXBkYXRlZF9hdCddLFxuICBqb2Jfc2tpbGxzOiBbJ2pvYl9pZCcsICdza2lsbCcsICdjcmVhdGVkX2F0J10sXG4gIGNvdXJzZXM6IFsnaWQnLCAndGl0bGUnLCAnY29kZScsICd1cGRhdGVkX2F0J10sXG4gIGNvdXJzZV9za2lsbHM6IFsnY291cnNlX2lkJywgJ3NraWxsJ10sXG4gIGNvdXJzZV9hbGlnbm1lbnRfc2NvcmVzOiBbJ2NvdXJzZV9pZCcsICdzY29yZScsICdjYWxjdWxhdGVkX2F0J10sXG4gIC8vIGFkZCBtb3JlIGFsbG93ZWQgdGFibGVzL2NvbHVtbnMgaGVyZVxufTtcblxuLy8gSGFyZCBjYXBzIHRvIHByb3RlY3QgdG9rZW5zXG5jb25zdCBNQVhfUk9XU19IQVJEID0gNTA7ICAgICAgIC8vIG5ldmVyIGZldGNoIG1vcmUgdGhhbiB0aGlzXG5jb25zdCBNQVhfQ09MU19IQVJEID0gODsgICAgICAgIC8vIG5ldmVyIHJldHVybiBtb3JlIHRoYW4gdGhpcyBtYW55IGNvbHVtbnNcbmNvbnN0IERFRkFVTFRfTElNSVQgPSAyNTsgICAgICAgLy8gc29mdCBjYXAgdW5sZXNzIHVzZXIgYXNrcyBmb3IgbW9yZVxuY29uc3QgREVGQVVMVF9TQU1QTEUgPSA4OyAgICAgICAvLyBudW1iZXIgb2Ygcm93cyB0byBpbmNsdWRlIGluIHRoZSBzYW1wbGVcbmNvbnN0IE1BWF9DRUxMX0xFTiA9IDgwOyAgICAgICAgLy8gdHJpbSBsb25nIHN0cmluZ3Mgc28gdGhlIHRvb2wgcmVzcG9uc2Ugc3RheXMgc21hbGxcbmNvbnN0IFRPUF9WQUxVRVNfUEVSX0NPTCA9IDU7ICAgLy8gc3VtbWFyaXplIGNhdGVnb3JpY2FsIGNvbHVtbnMgYnkgdG9wIE4gdmFsdWVzXG5cbmZ1bmN0aW9uIGdldFN1cGFSZWFkT25seSgpIHtcbiAgY29uc3QgdXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuICBjb25zdCBrZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZOyAvLyBzZXJ2ZXItb25seVxuICBpZiAoIXVybCkgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIGVudjogTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMJyk7XG4gIGlmICgha2V5KSB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgZW52OiBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZJyk7XG4gIHJldHVybiBjcmVhdGVDbGllbnQodXJsLCBrZXksIHsgYXV0aDogeyBwZXJzaXN0U2Vzc2lvbjogZmFsc2UgfSB9KTtcbn1cblxuY29uc3QgRGJTZWxlY3RTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHRhYmxlOiB6LnN0cmluZygpLFxuICBjb2x1bW5zOiB6LmFycmF5KHouc3RyaW5nKCkpLm9wdGlvbmFsKCksICAgICAgLy8gZGVmYXVsdDogYWxsIHdoaXRlbGlzdGVkIGNvbHNcbiAgZXE6IHoucmVjb3JkKHouc3RyaW5nKCksIHouc3RyaW5nKCkub3Ioei5udW1iZXIoKSkpLm9wdGlvbmFsKCksXG4gIGlsaWtlOiB6LnJlY29yZCh6LnN0cmluZygpLCB6LnN0cmluZygpKS5vcHRpb25hbCgpLCAvLyB1c2UgJS4uLiUgd2lsZGNhcmRzXG4gIGd0ZTogei5yZWNvcmQoei5zdHJpbmcoKSwgei5zdHJpbmcoKS5vcih6Lm51bWJlcigpKSkub3B0aW9uYWwoKSxcbiAgbHRlOiB6LnJlY29yZCh6LnN0cmluZygpLCB6LnN0cmluZygpLm9yKHoubnVtYmVyKCkpKS5vcHRpb25hbCgpLFxuICBvcmRlckJ5OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGRlc2M6IHouYm9vbGVhbigpLm9wdGlvbmFsKCksXG4gIGxpbWl0OiB6Lm51bWJlcigpLm1pbigxKS5tYXgoTUFYX1JPV1NfSEFSRCkub3B0aW9uYWwoKSxcbiAgb2Zmc2V0OiB6Lm51bWJlcigpLm1pbigwKS5tYXgoNTAwMCkub3B0aW9uYWwoKSxcbiAgLy8gdG9rZW4gb3B0aW1pemF0aW9uIGtub2JzXG4gIHNhbXBsZVNpemU6IHoubnVtYmVyKCkubWluKDApLm1heChERUZBVUxUX0xJTUlUKS5vcHRpb25hbCgpLCAvLyByb3dzIHRvIGluY2x1ZGUgaW4gc2FtcGxlXG4gIG1vZGU6IHouZW51bShbJ3N1bW1hcnknLCAncm93cyddKS5vcHRpb25hbCgpLCAgICAgICAgICAgICAgICAvLyAnc3VtbWFyeScgPSBjb21wYWN0IChkZWZhdWx0KSwgJ3Jvd3MnID0gc21hbGwgdGFidWxhciByZXR1cm5cbn0pO1xuXG5leHBvcnQgdHlwZSBEYlNlbGVjdEFyZ3MgPSB6LmluZmVyPHR5cGVvZiBEYlNlbGVjdFNjaGVtYT47XG5cbi8vIC0tLS0tLS0tLS0tLS0tLSBoZWxwZXJzIC0tLS0tLS0tLS0tLS0tLVxuY29uc3QgdHJpbUNlbGwgPSAodjogYW55KSA9PiB7XG4gIGlmICh2ID09IG51bGwpIHJldHVybiB2O1xuICBjb25zdCBzID0gU3RyaW5nKHYpO1xuICByZXR1cm4gcy5sZW5ndGggPiBNQVhfQ0VMTF9MRU4gPyBzLnNsaWNlKDAsIE1BWF9DRUxMX0xFTiAtIDEpICsgJ+KApicgOiBzO1xufTtcblxuY29uc3QgcGlja0FsbG93ZWRDb2x1bW5zID0gKHRhYmxlOiBzdHJpbmcsIHJlcXVlc3RlZD86IHN0cmluZ1tdKSA9PiB7XG4gIGNvbnN0IGFsbG93ZWQgPSBUQUJMRVNbdGFibGVdID8/IFtdO1xuICBjb25zdCBjb2xzID0gKHJlcXVlc3RlZCAmJiByZXF1ZXN0ZWQubGVuZ3RoID8gcmVxdWVzdGVkIDogYWxsb3dlZCkuZmlsdGVyKChjKSA9PlxuICAgIGFsbG93ZWQuaW5jbHVkZXMoYylcbiAgKTtcbiAgcmV0dXJuIGNvbHMuc2xpY2UoMCwgTUFYX0NPTFNfSEFSRCk7XG59O1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0gbWFpbiAtLS0tLS0tLS0tLS0tLS1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkYlNlbGVjdE9wdGltaXplZChyYXc6IERiU2VsZWN0QXJncykge1xuICBjb25zdCBhcmdzID0gRGJTZWxlY3RTY2hlbWEucGFyc2UocmF3KTtcbiAgY29uc3QgYWxsb3dlZENvbHMgPSBUQUJMRVNbYXJncy50YWJsZV07XG4gIGlmICghYWxsb3dlZENvbHMpIHtcbiAgICByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiBgVGFibGUgXCIke2FyZ3MudGFibGV9XCIgbm90IGFsbG93ZWRgIH07XG4gIH1cblxuICAvLyBjb2x1bW5zICYgbGltaXRzXG4gIGNvbnN0IGNvbHMgPSBwaWNrQWxsb3dlZENvbHVtbnMoYXJncy50YWJsZSwgYXJncy5jb2x1bW5zKTtcbiAgaWYgKCFjb2xzLmxlbmd0aCkgcmV0dXJuIHsgb2s6IGZhbHNlLCBlcnJvcjogJ05vIGFsbG93ZWQgY29sdW1ucyByZXF1ZXN0ZWQnIH07XG5cbiAgY29uc3QgbGltaXQgPSBNYXRoLm1pbihhcmdzLmxpbWl0ID8/IERFRkFVTFRfTElNSVQsIE1BWF9ST1dTX0hBUkQpO1xuICBjb25zdCBzYW1wbGVTaXplID0gTWF0aC5taW4oYXJncy5zYW1wbGVTaXplID8/IERFRkFVTFRfU0FNUExFLCBsaW1pdCk7XG5cbiAgY29uc3Qgc3VwYSA9IGdldFN1cGFSZWFkT25seSgpO1xuICBsZXQgcSA9IHN1cGEuZnJvbShhcmdzLnRhYmxlKS5zZWxlY3QoY29scy5qb2luKCcsJykpO1xuXG4gIC8vIGZpbHRlcnNcbiAgZm9yIChjb25zdCBncm91cCBvZiBbJ2VxJywgJ2lsaWtlJywgJ2d0ZScsICdsdGUnXSBhcyBjb25zdCkge1xuICAgIGNvbnN0IHJlYyA9IGFyZ3NbZ3JvdXBdO1xuICAgIGlmICghcmVjKSBjb250aW51ZTtcbiAgICBmb3IgKGNvbnN0IFtrLCB2XSBvZiBPYmplY3QuZW50cmllcyhyZWMpKSB7XG4gICAgICBpZiAoIWNvbHMuaW5jbHVkZXMoaykgJiYgIWFsbG93ZWRDb2xzLmluY2x1ZGVzKGspKSBjb250aW51ZTtcbiAgICAgIHN3aXRjaCAoZ3JvdXApIHtcbiAgICAgICAgY2FzZSAnZXEnOiBxID0gcS5lcShrLCB2IGFzIGFueSk7IGJyZWFrO1xuICAgICAgICBjYXNlICdpbGlrZSc6IHEgPSBxLmlsaWtlKGssIHYgYXMgc3RyaW5nKTsgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2d0ZSc6IHEgPSBxLmd0ZShrLCB2IGFzIGFueSk7IGJyZWFrO1xuICAgICAgICBjYXNlICdsdGUnOiBxID0gcS5sdGUoaywgdiBhcyBhbnkpOyBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBvcmRlciAvIHBhZ2luYXRpb25cbiAgaWYgKGFyZ3Mub3JkZXJCeSAmJiAoY29scy5pbmNsdWRlcyhhcmdzLm9yZGVyQnkpIHx8IGFsbG93ZWRDb2xzLmluY2x1ZGVzKGFyZ3Mub3JkZXJCeSkpKSB7XG4gICAgcSA9IHEub3JkZXIoYXJncy5vcmRlckJ5LCB7IGFzY2VuZGluZzogIWFyZ3MuZGVzYyB9KTtcbiAgfVxuICBpZiAoYXJncy5vZmZzZXQpIHEgPSBxLnJhbmdlKGFyZ3Mub2Zmc2V0LCBhcmdzLm9mZnNldCArIGxpbWl0IC0gMSk7XG4gIGVsc2UgcSA9IHEubGltaXQobGltaXQpO1xuXG4gIGNvbnN0IHJlcyA9IGF3YWl0IHE7XG4gIGlmIChyZXMuZXJyb3IpIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6IHJlcy5lcnJvci5tZXNzYWdlIH07XG5cbiAgY29uc3QgaXRlbXMgPSAocmVzLmRhdGEgPz8gW10pIGFzIFJlY29yZDxzdHJpbmcsIGFueT5bXTtcblxuICAvLyAtLS0tLS0tLS0tIGJ1aWxkIGNvbXBhY3Qgc3VtbWFyeSAtLS0tLS0tLS0tXG4gIGNvbnN0IHN1bW1hcnk6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7IHJvd0NvdW50OiBpdGVtcy5sZW5ndGgsIGNvbHVtbnM6IGNvbHMgfTtcblxuICAvLyBzaW1wbGUgdmFsdWUgY291bnRzIGZvciBjYXRlZ29yaWNhbC1pc2ggY29sdW1ucyAoc3RyaW5ncylcbiAgZm9yIChjb25zdCBjb2wgb2YgY29scykge1xuICAgIC8vIGNvbGxlY3QgZnJlcXVlbmN5IGlmIGNvbHVtbiBsb29rcyBjYXRlZ29yaWNhbCAoc3RyaW5nLCBzaG9ydClcbiAgICBjb25zdCBmcmVxID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICBsZXQgc3RyaW5neSA9IDA7XG4gICAgZm9yIChjb25zdCByIG9mIGl0ZW1zKSB7XG4gICAgICBjb25zdCB2ID0gcltjb2xdO1xuICAgICAgaWYgKHR5cGVvZiB2ID09PSAnc3RyaW5nJykge1xuICAgICAgICBzdHJpbmd5Kys7XG4gICAgICAgIGNvbnN0IGtleSA9IHRyaW1DZWxsKHYpO1xuICAgICAgICBmcmVxLnNldChrZXksIChmcmVxLmdldChrZXkpID8/IDApICsgMSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChzdHJpbmd5ICYmIGZyZXEuc2l6ZSkge1xuICAgICAgY29uc3QgdG9wID0gWy4uLmZyZXEuZW50cmllcygpXVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pXG4gICAgICAgIC5zbGljZSgwLCBUT1BfVkFMVUVTX1BFUl9DT0wpXG4gICAgICAgIC5tYXAoKFt2YWx1ZSwgY291bnRdKSA9PiAoeyB2YWx1ZSwgY291bnQgfSkpO1xuICAgICAgc3VtbWFyeVtjb2xdID0geyB0b3BWYWx1ZXM6IHRvcCwgZGlzdGluY3Q6IGZyZXEuc2l6ZSB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIG51bWVyaWMgYWdncmVnYXRlc1xuICBmb3IgKGNvbnN0IGNvbCBvZiBjb2xzKSB7XG4gICAgY29uc3QgbnVtcyA9IGl0ZW1zLm1hcCgocikgPT4gTnVtYmVyKHJbY29sXSkpLmZpbHRlcigobikgPT4gTnVtYmVyLmlzRmluaXRlKG4pKTtcbiAgICBpZiAobnVtcy5sZW5ndGggPj0gMykge1xuICAgICAgY29uc3QgbWluID0gTWF0aC5taW4oLi4ubnVtcyk7XG4gICAgICBjb25zdCBtYXggPSBNYXRoLm1heCguLi5udW1zKTtcbiAgICAgIGNvbnN0IGF2ZyA9IG51bXMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyBudW1zLmxlbmd0aDtcbiAgICAgIHN1bW1hcnlbY29sXSA9IHtcbiAgICAgICAgLi4uKHN1bW1hcnlbY29sXSB8fCB7fSksXG4gICAgICAgIHN0YXRzOiB7IG1pbiwgbWF4LCBhdmc6IE51bWJlcihhdmcudG9GaXhlZCgzKSksIG46IG51bXMubGVuZ3RoIH0sXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIHNtYWxsIHNhbXBsZSBvZiByb3dzICh0cmltbWVkKVxuICBjb25zdCBzYW1wbGVSb3dzID0gaXRlbXMuc2xpY2UoMCwgc2FtcGxlU2l6ZSkubWFwKChyKSA9PiB7XG4gICAgY29uc3Qgb2JqOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gICAgZm9yIChjb25zdCBjIG9mIGNvbHMpIG9ialtjXSA9IHRyaW1DZWxsKHJbY10pO1xuICAgIHJldHVybiBvYmo7XG4gIH0pO1xuXG4gIC8vICdyb3dzJyBtb2RlIHJldHVybnMgb25seSBhIHNtYWxsIHRyaW1tZWQgcm93IHNldCAoc3RpbGwgdG9rZW4tc2FmZSlcbiAgaWYgKGFyZ3MubW9kZSA9PT0gJ3Jvd3MnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9rOiB0cnVlLFxuICAgICAgbW9kZTogJ3Jvd3MnLFxuICAgICAgdGFibGU6IGFyZ3MudGFibGUsXG4gICAgICByZXR1cm5lZDogc2FtcGxlUm93cy5sZW5ndGgsXG4gICAgICBsaW1pdEFwcGxpZWQ6IGxpbWl0LFxuICAgICAgY29sdW1uczogY29scyxcbiAgICAgIHJvd3M6IHNhbXBsZVJvd3MsXG4gICAgICBub3RlOiBgVHJpbW1lZCB0byAke3NhbXBsZVJvd3MubGVuZ3RofSByb3dzLCAke2NvbHMubGVuZ3RofSBjb2xzLiBDZWxscyA+ICR7TUFYX0NFTExfTEVOfSBjaGFycyB0cnVuY2F0ZWQuYCxcbiAgICB9O1xuICB9XG5cbiAgLy8gZGVmYXVsdDogJ3N1bW1hcnknIG1vZGVcbiAgcmV0dXJuIHtcbiAgICBvazogdHJ1ZSxcbiAgICBtb2RlOiAnc3VtbWFyeScsXG4gICAgdGFibGU6IGFyZ3MudGFibGUsXG4gICAgbGltaXRBcHBsaWVkOiBsaW1pdCxcbiAgICBjb2x1bW5zOiBjb2xzLFxuICAgIHNhbXBsZTogc2FtcGxlUm93cyxcbiAgICBzdW1tYXJ5LFxuICAgIG5vdGU6IGBTdW1tYXJ5IHdpdGggJHtzYW1wbGVSb3dzLmxlbmd0aH0gc2FtcGxlIHJvd3MuIENlbGxzID4gJHtNQVhfQ0VMTF9MRU59IGNoYXJzIHRydW5jYXRlZC5gLFxuICB9O1xufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInoiLCJUQUJMRVMiLCJqb2JzIiwiam9iX3NraWxscyIsImNvdXJzZXMiLCJjb3Vyc2Vfc2tpbGxzIiwiY291cnNlX2FsaWdubWVudF9zY29yZXMiLCJNQVhfUk9XU19IQVJEIiwiTUFYX0NPTFNfSEFSRCIsIkRFRkFVTFRfTElNSVQiLCJERUZBVUxUX1NBTVBMRSIsIk1BWF9DRUxMX0xFTiIsIlRPUF9WQUxVRVNfUEVSX0NPTCIsImdldFN1cGFSZWFkT25seSIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJrZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiRXJyb3IiLCJhdXRoIiwicGVyc2lzdFNlc3Npb24iLCJEYlNlbGVjdFNjaGVtYSIsIm9iamVjdCIsInRhYmxlIiwic3RyaW5nIiwiY29sdW1ucyIsImFycmF5Iiwib3B0aW9uYWwiLCJlcSIsInJlY29yZCIsIm9yIiwibnVtYmVyIiwiaWxpa2UiLCJndGUiLCJsdGUiLCJvcmRlckJ5IiwiZGVzYyIsImJvb2xlYW4iLCJsaW1pdCIsIm1pbiIsIm1heCIsIm9mZnNldCIsInNhbXBsZVNpemUiLCJtb2RlIiwiZW51bSIsInRyaW1DZWxsIiwidiIsInMiLCJTdHJpbmciLCJsZW5ndGgiLCJzbGljZSIsInBpY2tBbGxvd2VkQ29sdW1ucyIsInJlcXVlc3RlZCIsImFsbG93ZWQiLCJjb2xzIiwiZmlsdGVyIiwiYyIsImluY2x1ZGVzIiwiZGJTZWxlY3RPcHRpbWl6ZWQiLCJyYXciLCJhcmdzIiwicGFyc2UiLCJhbGxvd2VkQ29scyIsIm9rIiwiZXJyb3IiLCJNYXRoIiwic3VwYSIsInEiLCJmcm9tIiwic2VsZWN0Iiwiam9pbiIsImdyb3VwIiwicmVjIiwiayIsIk9iamVjdCIsImVudHJpZXMiLCJvcmRlciIsImFzY2VuZGluZyIsInJhbmdlIiwicmVzIiwibWVzc2FnZSIsIml0ZW1zIiwiZGF0YSIsInN1bW1hcnkiLCJyb3dDb3VudCIsImNvbCIsImZyZXEiLCJNYXAiLCJzdHJpbmd5IiwiciIsInNldCIsImdldCIsInNpemUiLCJ0b3AiLCJzb3J0IiwiYSIsImIiLCJtYXAiLCJ2YWx1ZSIsImNvdW50IiwidG9wVmFsdWVzIiwiZGlzdGluY3QiLCJudW1zIiwiTnVtYmVyIiwibiIsImlzRmluaXRlIiwiYXZnIiwicmVkdWNlIiwic3RhdHMiLCJ0b0ZpeGVkIiwic2FtcGxlUm93cyIsIm9iaiIsInJldHVybmVkIiwibGltaXRBcHBsaWVkIiwicm93cyIsIm5vdGUiLCJzYW1wbGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/carly/db.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/carly/route.ts":
/*!************************************!*\
  !*** ./src/app/api/carly/route.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var _google_genai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/genai */ \"(rsc)/../node_modules/@google/genai/dist/node/index.mjs\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/../node_modules/zod/v4/classic/schemas.js\");\n/* harmony import */ var _tools__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tools */ \"(rsc)/./src/app/api/carly/tools.ts\");\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./db */ \"(rsc)/./src/app/api/carly/db.ts\");\n// api/carly/route.ts\n\n\n\n\n\nconst runtime = 'nodejs';\nconst dynamic = 'force-dynamic';\nconst ai = new _google_genai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenAI({\n    apiKey: process.env.GEMINI_API_KEY\n});\nfunction getSupaAdmin() {\n    const url = \"https://swiuodmiiuqausjombgm.supabase.co\";\n    const key = process.env.SUPABASE_SERVICE_ROLE_KEY; // server-only\n    if (!url) throw new Error('Missing env: NEXT_PUBLIC_SUPABASE_URL');\n    if (!key) throw new Error('Missing env: SUPABASE_SERVICE_ROLE_KEY');\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_3__.createClient)(url, key, {\n        auth: {\n            persistSession: false\n        }\n    });\n}\nconst BodySchema = zod__WEBPACK_IMPORTED_MODULE_4__.object({\n    messages: zod__WEBPACK_IMPORTED_MODULE_4__.array(zod__WEBPACK_IMPORTED_MODULE_4__.object({\n        role: zod__WEBPACK_IMPORTED_MODULE_4__[\"enum\"]([\n            'user',\n            'assistant'\n        ]),\n        content: zod__WEBPACK_IMPORTED_MODULE_4__.string()\n    })),\n    filterSource: zod__WEBPACK_IMPORTED_MODULE_4__.string().optional(),\n    k: zod__WEBPACK_IMPORTED_MODULE_4__.number().optional()\n});\n// ----------------- helpers -----------------\nasync function embedQuery(q) {\n    // Embed the plain query text; keep config explicit\n    const res = await ai.models.embedContent({\n        model: 'gemini-embedding-001',\n        contents: q,\n        config: {\n            taskType: 'RETRIEVAL_QUERY',\n            outputDimensionality: 768\n        }\n    });\n    if (!res.embeddings) throw new Error('Gemini did not return embeddings for embedQuery');\n    return res.embeddings[0].values;\n}\nasync function retrieveContext(queryText, filterSource, k = 8) {\n    const qVec = await embedQuery(queryText);\n    const supa = getSupaAdmin();\n    const { data, error } = await supa.rpc('match_carly_documents', {\n        query_embedding: qVec,\n        match_count: k,\n        filter_source: filterSource ?? null\n    });\n    if (error) throw error;\n    return (data ?? []).map((d)=>`SOURCE: ${d.source}${d.title ? ` | ${d.title}` : ''}\\n${d.content}`).join('\\n---\\n');\n}\n// We include \"system\" policy inside the first user turn (Gemini SDK doesn't support a system param).\nconst SYSTEM = `\nYou are ${process.env.CARLY_NAME ?? 'Carly'}, the built-in assistant for our app.\nStyle: concise, accurate, cite sources (by SOURCE label if present), avoid speculation.\nIf asked about pipeline/metrics, prefer live data via tools or RAG context.\nIf you don't know, say so and propose a next step.\nDo not repeat the prompt or the context in your answer.\n\nYou may call dbSelect to read allowed tables (jobs, job_skills, courses, course_skills, course_alignment_scores).\nPrefer mode=\"summary\", limit  25, and only necessary columns. Use filters (eq/ilike/gte/lte) to narrow results.\n`.trim();\n// ---------- robust stream normalizer (no echo) ----------\nconst lcp = (a, b)=>{\n    const n = Math.min(a.length, b.length);\n    let i = 0;\n    while(i < n && a.charCodeAt(i) === b.charCodeAt(i))i++;\n    return i;\n};\nconst getTextFromChunk = (c)=>{\n    if (!c) return '';\n    if (typeof c.text === 'string') return c.text;\n    if (c.delta?.text) return c.delta.text;\n    const cand = c.candidatesChunk?.candidates?.[0];\n    if (cand?.content?.parts?.length) {\n        return cand.content.parts.map((p)=>typeof p.text === 'string' ? p.text : '').join('');\n    }\n    if (Array.isArray(c.parts)) {\n        return c.parts.map((p)=>p?.text ?? '').join('');\n    }\n    if (Array.isArray(c.candidates)) {\n        const p = c.candidates[0]?.content?.parts ?? [];\n        return p.map((x)=>x?.text ?? '').join('');\n    }\n    return '';\n};\nasync function pipeModelStreamToSSE(resp, controller) {\n    let total = '';\n    let lastEmitted = '';\n    for await (const chunk of resp){\n        const piece = getTextFromChunk(chunk);\n        if (!piece) continue;\n        let fresh = '';\n        if (piece.startsWith(total)) {\n            // cumulative\n            fresh = piece.slice(total.length);\n            total = piece;\n        } else {\n            // delta or rewind  compute safe suffix\n            const i = lcp(total, piece);\n            fresh = piece.slice(i);\n            total = piece;\n        }\n        if (fresh && fresh !== lastEmitted) {\n            controller.enqueue(`data: ${JSON.stringify({\n                delta: fresh\n            })}\\n\\n`);\n            lastEmitted = fresh;\n        }\n    }\n}\n// ----------------- main handler -----------------\nasync function POST(req) {\n    const body = await req.json();\n    const { messages, filterSource, k } = BodySchema.parse(body);\n    const userLast = [\n        ...messages\n    ].reverse().find((m)=>m.role === 'user')?.content ?? '';\n    const context = await retrieveContext(userLast, filterSource, k);\n    const stream = new ReadableStream({\n        async start (controller) {\n            try {\n                // A single clean user message that carries policy + context + question.\n                const contents = [\n                    {\n                        role: 'user',\n                        parts: [\n                            {\n                                text: `POLICY:\n${SYSTEM}\n\nCONTEXT (RAG):\n${context || '(none)'}\n\nUSER:\n${userLast}`\n                            }\n                        ]\n                    }\n                ];\n                // Tool declarations (dbSelect + existing skill/alignment tools)\n                const tools = [\n                    {\n                        functionDeclarations: [\n                            // Generic DB (token-optimized)\n                            {\n                                name: 'dbSelect',\n                                description: 'Read whitelisted tables with filters. Returns a compact summary and small sample to save tokens.',\n                                parametersJsonSchema: {\n                                    type: 'object',\n                                    properties: {\n                                        table: {\n                                            type: 'string'\n                                        },\n                                        columns: {\n                                            type: 'array',\n                                            items: {\n                                                type: 'string'\n                                            }\n                                        },\n                                        eq: {\n                                            type: 'object',\n                                            additionalProperties: {\n                                                anyOf: [\n                                                    {\n                                                        type: 'string'\n                                                    },\n                                                    {\n                                                        type: 'number'\n                                                    }\n                                                ]\n                                            }\n                                        },\n                                        ilike: {\n                                            type: 'object',\n                                            additionalProperties: {\n                                                type: 'string'\n                                            }\n                                        },\n                                        gte: {\n                                            type: 'object',\n                                            additionalProperties: {\n                                                anyOf: [\n                                                    {\n                                                        type: 'string'\n                                                    },\n                                                    {\n                                                        type: 'number'\n                                                    }\n                                                ]\n                                            }\n                                        },\n                                        lte: {\n                                            type: 'object',\n                                            additionalProperties: {\n                                                anyOf: [\n                                                    {\n                                                        type: 'string'\n                                                    },\n                                                    {\n                                                        type: 'number'\n                                                    }\n                                                ]\n                                            }\n                                        },\n                                        orderBy: {\n                                            type: 'string'\n                                        },\n                                        desc: {\n                                            type: 'boolean'\n                                        },\n                                        limit: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 50\n                                        },\n                                        offset: {\n                                            type: 'number',\n                                            minimum: 0,\n                                            maximum: 5000\n                                        },\n                                        sampleSize: {\n                                            type: 'number',\n                                            minimum: 0,\n                                            maximum: 25\n                                        },\n                                        mode: {\n                                            type: 'string',\n                                            enum: [\n                                                'summary',\n                                                'rows'\n                                            ]\n                                        }\n                                    },\n                                    required: [\n                                        'table'\n                                    ]\n                                }\n                            },\n                            // KPIs\n                            {\n                                name: 'getLatestKPIs',\n                                description: 'Return dashboard KPI snapshot.',\n                                parametersJsonSchema: {\n                                    type: 'object',\n                                    properties: {}\n                                }\n                            },\n                            // Skills & alignment (DB-backed)\n                            {\n                                name: 'getTopInDemandSkills',\n                                description: 'Top in-demand skills from recent job postings.',\n                                parametersJsonSchema: {\n                                    type: 'object',\n                                    properties: {\n                                        windowDays: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 365\n                                        },\n                                        limit: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 100\n                                        },\n                                        minCount: {\n                                            type: 'number',\n                                            minimum: 0,\n                                            maximum: 10000\n                                        }\n                                    }\n                                }\n                            },\n                            {\n                                name: 'getCourseSkillCoverage',\n                                description: 'Skills a course teaches and how they overlap with market demand.',\n                                parametersJsonSchema: {\n                                    type: 'object',\n                                    properties: {\n                                        courseId: {\n                                            type: 'string'\n                                        },\n                                        windowDays: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 365\n                                        }\n                                    },\n                                    required: [\n                                        'courseId'\n                                    ]\n                                }\n                            },\n                            {\n                                name: 'getMissingSkillsForCourse',\n                                description: 'In-demand skills that a course does not cover.',\n                                parametersJsonSchema: {\n                                    type: 'object',\n                                    properties: {\n                                        courseId: {\n                                            type: 'string'\n                                        },\n                                        windowDays: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 365\n                                        },\n                                        minCount: {\n                                            type: 'number',\n                                            minimum: 0,\n                                            maximum: 10000\n                                        },\n                                        limit: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 200\n                                        }\n                                    },\n                                    required: [\n                                        'courseId'\n                                    ]\n                                }\n                            },\n                            {\n                                name: 'getAlignmentSummary',\n                                description: 'Average alignment scores for a course or across courses.',\n                                parametersJsonSchema: {\n                                    type: 'object',\n                                    properties: {\n                                        courseId: {\n                                            type: 'string'\n                                        },\n                                        windowDays: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 365\n                                        }\n                                    }\n                                }\n                            },\n                            // Optional dataService-backed variants\n                            {\n                                name: 'getInDemandSkillsViaService',\n                                description: 'Use dataService.ts (if available) to compute in-demand skills.',\n                                parametersJsonSchema: {\n                                    type: 'object',\n                                    properties: {\n                                        windowDays: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 365\n                                        },\n                                        limit: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 100\n                                        },\n                                        minCount: {\n                                            type: 'number',\n                                            minimum: 0,\n                                            maximum: 10000\n                                        }\n                                    }\n                                }\n                            },\n                            {\n                                name: 'getCourseSkillCoverageViaService',\n                                description: 'Use dataService.ts (if available) to compute course skill coverage.',\n                                parametersJsonSchema: {\n                                    type: 'object',\n                                    properties: {\n                                        courseId: {\n                                            type: 'string'\n                                        },\n                                        windowDays: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 365\n                                        }\n                                    },\n                                    required: [\n                                        'courseId'\n                                    ]\n                                }\n                            },\n                            {\n                                name: 'getMissingSkillsForCourseViaService',\n                                description: 'Use dataService.ts (if available) to compute missing skills for a course.',\n                                parametersJsonSchema: {\n                                    type: 'object',\n                                    properties: {\n                                        courseId: {\n                                            type: 'string'\n                                        },\n                                        windowDays: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 365\n                                        },\n                                        minCount: {\n                                            type: 'number',\n                                            minimum: 0,\n                                            maximum: 10000\n                                        },\n                                        limit: {\n                                            type: 'number',\n                                            minimum: 1,\n                                            maximum: 200\n                                        }\n                                    },\n                                    required: [\n                                        'courseId'\n                                    ]\n                                }\n                            }\n                        ]\n                    }\n                ];\n                // 1) Probe for tool call (non-stream)\n                const first = await ai.models.generateContent({\n                    model: process.env.CARLY_MODEL || 'gemini-2.5-flash',\n                    contents,\n                    config: {\n                        tools,\n                        toolConfig: {\n                            functionCallingConfig: {\n                                mode: _google_genai__WEBPACK_IMPORTED_MODULE_0__.FunctionCallingConfigMode.AUTO\n                            }\n                        }\n                    }\n                });\n                const functionCalls = first.functionCalls;\n                if (functionCalls?.length) {\n                    // Tool call path\n                    const call = functionCalls[0];\n                    let result = {};\n                    try {\n                        switch(call.name){\n                            // Generic DB\n                            case 'dbSelect':\n                                {\n                                    if (!call.args || typeof call.args.table !== 'string') {\n                                        result = {\n                                            ok: false,\n                                            error: 'dbSelect: missing required \"table\" argument'\n                                        };\n                                        break;\n                                    }\n                                    // Safe to cast after the guard\n                                    result = await (0,_db__WEBPACK_IMPORTED_MODULE_2__.dbSelectOptimized)(call.args);\n                                    break;\n                                }\n                            // KPIs\n                            case 'getLatestKPIs':\n                                result = await (0,_tools__WEBPACK_IMPORTED_MODULE_1__.getLatestKPIs)();\n                                break;\n                            // Skills (DB-backed)\n                            case 'getTopInDemandSkills':\n                                result = await (0,_tools__WEBPACK_IMPORTED_MODULE_1__.getTopInDemandSkills)({\n                                    windowDays: call.args?.windowDays,\n                                    limit: call.args?.limit,\n                                    minCount: call.args?.minCount\n                                });\n                                break;\n                            case 'getCourseSkillCoverage':\n                                result = await (0,_tools__WEBPACK_IMPORTED_MODULE_1__.getCourseSkillCoverage)({\n                                    courseId: String(call.args?.courseId ?? ''),\n                                    windowDays: call.args?.windowDays\n                                });\n                                break;\n                            case 'getMissingSkillsForCourse':\n                                result = await (0,_tools__WEBPACK_IMPORTED_MODULE_1__.getMissingSkillsForCourse)({\n                                    courseId: String(call.args?.courseId ?? ''),\n                                    windowDays: call.args?.windowDays,\n                                    minCount: call.args?.minCount,\n                                    limit: call.args?.limit\n                                });\n                                break;\n                            case 'getAlignmentSummary':\n                                result = await (0,_tools__WEBPACK_IMPORTED_MODULE_1__.getAlignmentSummary)({\n                                    courseId: call.args?.courseId,\n                                    windowDays: call.args?.windowDays\n                                });\n                                break;\n                            // dataService-backed variants\n                            case 'getInDemandSkillsViaService':\n                                result = await (0,_tools__WEBPACK_IMPORTED_MODULE_1__.getInDemandSkillsViaService)({\n                                    windowDays: call.args?.windowDays,\n                                    limit: call.args?.limit,\n                                    minCount: call.args?.minCount\n                                });\n                                break;\n                            case 'getCourseSkillCoverageViaService':\n                                result = await (0,_tools__WEBPACK_IMPORTED_MODULE_1__.getCourseSkillCoverageViaService)({\n                                    courseId: String(call.args?.courseId ?? ''),\n                                    windowDays: call.args?.windowDays\n                                });\n                                break;\n                            case 'getMissingSkillsForCourseViaService':\n                                result = await (0,_tools__WEBPACK_IMPORTED_MODULE_1__.getMissingSkillsForCourseViaService)({\n                                    courseId: String(call.args?.courseId ?? ''),\n                                    windowDays: call.args?.windowDays,\n                                    minCount: call.args?.minCount,\n                                    limit: call.args?.limit\n                                });\n                                break;\n                            default:\n                                result = {\n                                    ok: false,\n                                    error: `Unknown tool: ${call.name}`\n                                };\n                        }\n                    } catch (e) {\n                        result = {\n                            ok: false,\n                            error: e?.message || String(e)\n                        };\n                    }\n                    const newContents = [\n                        ...contents,\n                        {\n                            role: 'tool',\n                            parts: [\n                                {\n                                    functionResponse: {\n                                        name: call.name,\n                                        response: result\n                                    }\n                                }\n                            ]\n                        }\n                    ];\n                    const resp = await ai.models.generateContentStream({\n                        model: process.env.CARLY_MODEL || 'gemini-2.5-flash',\n                        contents: newContents\n                    });\n                    await pipeModelStreamToSSE(resp, controller);\n                } else {\n                    // No tool call  stream the answer\n                    const resp = await ai.models.generateContentStream({\n                        model: process.env.CARLY_MODEL || 'gemini-2.5-flash',\n                        contents\n                    });\n                    await pipeModelStreamToSSE(resp, controller);\n                }\n                controller.enqueue(`event: done\\ndata: {}\\n\\n`);\n                controller.close();\n            } catch (err) {\n                console.error('API Error:', err);\n                controller.enqueue(`event: error\\ndata: ${JSON.stringify({\n                    error: err.message\n                })}\\n\\n`);\n                controller.close();\n            }\n        }\n    });\n    return new Response(stream, {\n        headers: {\n            'Content-Type': 'text/event-stream; charset=utf-8',\n            'Cache-Control': 'no-cache, no-transform',\n            Connection: 'keep-alive',\n            'Access-Control-Allow-Origin': '*',\n            'X-Accel-Buffering': 'no'\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RjtJQUVBLE9BQU8sSUFBSUcsU0FBU3BELFFBQVE7UUFDMUJxRCxTQUFTO1lBQ1AsZ0JBQWdCO1lBQ2hCLGlCQUFpQjtZQUNqQkMsWUFBWTtZQUNaLCtCQUErQjtZQUMvQixxQkFBcUI7UUFDdkI7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc3RhbC9Eb2N1bWVudHMvUHJvamVjdHMvY3VycmljYWxpZ24vZnJvbnRlbmQvc3JjL2FwcC9hcGkvY2FybHkvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gYXBpL2Nhcmx5L3JvdXRlLnRzXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IEdvb2dsZUdlbkFJLCBGdW5jdGlvbkNhbGxpbmdDb25maWdNb2RlIH0gZnJvbSAnQGdvb2dsZS9nZW5haSc7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5cbmltcG9ydCB7XG4gIGdldExhdGVzdEtQSXMsXG4gIGdldFRvcEluRGVtYW5kU2tpbGxzLFxuICBnZXRDb3Vyc2VTa2lsbENvdmVyYWdlLFxuICBnZXRNaXNzaW5nU2tpbGxzRm9yQ291cnNlLFxuICBnZXRBbGlnbm1lbnRTdW1tYXJ5LFxuICBnZXRJbkRlbWFuZFNraWxsc1ZpYVNlcnZpY2UsXG4gIGdldENvdXJzZVNraWxsQ292ZXJhZ2VWaWFTZXJ2aWNlLFxuICBnZXRNaXNzaW5nU2tpbGxzRm9yQ291cnNlVmlhU2VydmljZSxcbn0gZnJvbSAnLi90b29scyc7XG5cbmltcG9ydCB7IGRiU2VsZWN0T3B0aW1pemVkIH0gZnJvbSAnLi9kYic7XG5cbmV4cG9ydCBjb25zdCBydW50aW1lID0gJ25vZGVqcyc7XG5leHBvcnQgY29uc3QgZHluYW1pYyA9ICdmb3JjZS1keW5hbWljJztcblxuY29uc3QgYWkgPSBuZXcgR29vZ2xlR2VuQUkoeyBhcGlLZXk6IHByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZISB9KTtcblxuZnVuY3Rpb24gZ2V0U3VwYUFkbWluKCkge1xuICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XG4gIGNvbnN0IGtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7IC8vIHNlcnZlci1vbmx5XG4gIGlmICghdXJsKSB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgZW52OiBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwnKTtcbiAgaWYgKCFrZXkpIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBlbnY6IFNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVknKTtcbiAgcmV0dXJuIGNyZWF0ZUNsaWVudCh1cmwsIGtleSwgeyBhdXRoOiB7IHBlcnNpc3RTZXNzaW9uOiBmYWxzZSB9IH0pO1xufVxuXG5jb25zdCBCb2R5U2NoZW1hID0gei5vYmplY3Qoe1xuICBtZXNzYWdlczogei5hcnJheSh6Lm9iamVjdCh7IHJvbGU6IHouZW51bShbJ3VzZXInLCAnYXNzaXN0YW50J10pLCBjb250ZW50OiB6LnN0cmluZygpIH0pKSxcbiAgZmlsdGVyU291cmNlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGs6IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbn0pO1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLSBoZWxwZXJzIC0tLS0tLS0tLS0tLS0tLS0tXG5cbmFzeW5jIGZ1bmN0aW9uIGVtYmVkUXVlcnkocTogc3RyaW5nKSB7XG4gIC8vIEVtYmVkIHRoZSBwbGFpbiBxdWVyeSB0ZXh0OyBrZWVwIGNvbmZpZyBleHBsaWNpdFxuICBjb25zdCByZXMgPSBhd2FpdCBhaS5tb2RlbHMuZW1iZWRDb250ZW50KHtcbiAgICBtb2RlbDogJ2dlbWluaS1lbWJlZGRpbmctMDAxJyxcbiAgICBjb250ZW50czogcSxcbiAgICBjb25maWc6IHsgdGFza1R5cGU6ICdSRVRSSUVWQUxfUVVFUlknLCBvdXRwdXREaW1lbnNpb25hbGl0eTogNzY4IH0gYXMgYW55LFxuICB9KTtcbiAgaWYgKCEocmVzIGFzIGFueSkuZW1iZWRkaW5ncykgdGhyb3cgbmV3IEVycm9yKCdHZW1pbmkgZGlkIG5vdCByZXR1cm4gZW1iZWRkaW5ncyBmb3IgZW1iZWRRdWVyeScpO1xuICByZXR1cm4gKHJlcyBhcyBhbnkpLmVtYmVkZGluZ3NbMF0udmFsdWVzIGFzIG51bWJlcltdO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZXRyaWV2ZUNvbnRleHQocXVlcnlUZXh0OiBzdHJpbmcsIGZpbHRlclNvdXJjZT86IHN0cmluZywgayA9IDgpIHtcbiAgY29uc3QgcVZlYyA9IGF3YWl0IGVtYmVkUXVlcnkocXVlcnlUZXh0KTtcbiAgY29uc3Qgc3VwYSA9IGdldFN1cGFBZG1pbigpO1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhLnJwYygnbWF0Y2hfY2FybHlfZG9jdW1lbnRzJywge1xuICAgIHF1ZXJ5X2VtYmVkZGluZzogcVZlYyxcbiAgICBtYXRjaF9jb3VudDogayxcbiAgICBmaWx0ZXJfc291cmNlOiBmaWx0ZXJTb3VyY2UgPz8gbnVsbCxcbiAgfSk7XG4gIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gIHJldHVybiAoZGF0YSA/PyBbXSlcbiAgICAubWFwKFxuICAgICAgKGQ6IGFueSkgPT4gYFNPVVJDRTogJHtkLnNvdXJjZX0ke2QudGl0bGUgPyBgIHwgJHtkLnRpdGxlfWAgOiAnJ31cXG4ke2QuY29udGVudH1gXG4gICAgKVxuICAgIC5qb2luKCdcXG4tLS1cXG4nKTtcbn1cblxuLy8gV2UgaW5jbHVkZSBcInN5c3RlbVwiIHBvbGljeSBpbnNpZGUgdGhlIGZpcnN0IHVzZXIgdHVybiAoR2VtaW5pIFNESyBkb2Vzbid0IHN1cHBvcnQgYSBzeXN0ZW0gcGFyYW0pLlxuY29uc3QgU1lTVEVNID0gYFxuWW91IGFyZSAke3Byb2Nlc3MuZW52LkNBUkxZX05BTUUgPz8gJ0Nhcmx5J30sIHRoZSBidWlsdC1pbiBhc3Npc3RhbnQgZm9yIG91ciBhcHAuXG5TdHlsZTogY29uY2lzZSwgYWNjdXJhdGUsIGNpdGUgc291cmNlcyAoYnkgU09VUkNFIGxhYmVsIGlmIHByZXNlbnQpLCBhdm9pZCBzcGVjdWxhdGlvbi5cbklmIGFza2VkIGFib3V0IHBpcGVsaW5lL21ldHJpY3MsIHByZWZlciBsaXZlIGRhdGEgdmlhIHRvb2xzIG9yIFJBRyBjb250ZXh0LlxuSWYgeW91IGRvbid0IGtub3csIHNheSBzbyBhbmQgcHJvcG9zZSBhIG5leHQgc3RlcC5cbkRvIG5vdCByZXBlYXQgdGhlIHByb21wdCBvciB0aGUgY29udGV4dCBpbiB5b3VyIGFuc3dlci5cblxuWW91IG1heSBjYWxsIGRiU2VsZWN0IHRvIHJlYWQgYWxsb3dlZCB0YWJsZXMgKGpvYnMsIGpvYl9za2lsbHMsIGNvdXJzZXMsIGNvdXJzZV9za2lsbHMsIGNvdXJzZV9hbGlnbm1lbnRfc2NvcmVzKS5cblByZWZlciBtb2RlPVwic3VtbWFyeVwiLCBsaW1pdCDiiaQgMjUsIGFuZCBvbmx5IG5lY2Vzc2FyeSBjb2x1bW5zLiBVc2UgZmlsdGVycyAoZXEvaWxpa2UvZ3RlL2x0ZSkgdG8gbmFycm93IHJlc3VsdHMuXG5gLnRyaW0oKTtcblxuLy8gLS0tLS0tLS0tLSByb2J1c3Qgc3RyZWFtIG5vcm1hbGl6ZXIgKG5vIGVjaG8pIC0tLS0tLS0tLS1cbmNvbnN0IGxjcCA9IChhOiBzdHJpbmcsIGI6IHN0cmluZykgPT4ge1xuICBjb25zdCBuID0gTWF0aC5taW4oYS5sZW5ndGgsIGIubGVuZ3RoKTtcbiAgbGV0IGkgPSAwO1xuICB3aGlsZSAoaSA8IG4gJiYgYS5jaGFyQ29kZUF0KGkpID09PSBiLmNoYXJDb2RlQXQoaSkpIGkrKztcbiAgcmV0dXJuIGk7XG59O1xuXG5jb25zdCBnZXRUZXh0RnJvbUNodW5rID0gKGM6IGFueSk6IHN0cmluZyA9PiB7XG4gIGlmICghYykgcmV0dXJuICcnO1xuICBpZiAodHlwZW9mIGMudGV4dCA9PT0gJ3N0cmluZycpIHJldHVybiBjLnRleHQ7XG4gIGlmICgoYyBhcyBhbnkpLmRlbHRhPy50ZXh0KSByZXR1cm4gKGMgYXMgYW55KS5kZWx0YS50ZXh0O1xuXG4gIGNvbnN0IGNhbmQgPSAoYyBhcyBhbnkpLmNhbmRpZGF0ZXNDaHVuaz8uY2FuZGlkYXRlcz8uWzBdO1xuICBpZiAoY2FuZD8uY29udGVudD8ucGFydHM/Lmxlbmd0aCkge1xuICAgIHJldHVybiBjYW5kLmNvbnRlbnQucGFydHMubWFwKChwOiBhbnkpID0+ICh0eXBlb2YgcC50ZXh0ID09PSAnc3RyaW5nJyA/IHAudGV4dCA6ICcnKSkuam9pbignJyk7XG4gIH1cblxuICBpZiAoQXJyYXkuaXNBcnJheSgoYyBhcyBhbnkpLnBhcnRzKSkge1xuICAgIHJldHVybiAoYyBhcyBhbnkpLnBhcnRzLm1hcCgocDogYW55KSA9PiBwPy50ZXh0ID8/ICcnKS5qb2luKCcnKTtcbiAgfVxuXG4gIGlmIChBcnJheS5pc0FycmF5KChjIGFzIGFueSkuY2FuZGlkYXRlcykpIHtcbiAgICBjb25zdCBwID0gYy5jYW5kaWRhdGVzWzBdPy5jb250ZW50Py5wYXJ0cyA/PyBbXTtcbiAgICByZXR1cm4gcC5tYXAoKHg6IGFueSkgPT4geD8udGV4dCA/PyAnJykuam9pbignJyk7XG4gIH1cbiAgcmV0dXJuICcnO1xufTtcblxuYXN5bmMgZnVuY3Rpb24gcGlwZU1vZGVsU3RyZWFtVG9TU0UoXG4gIHJlc3A6IEFzeW5jSXRlcmFibGU8YW55PixcbiAgY29udHJvbGxlcjogUmVhZGFibGVTdHJlYW1EZWZhdWx0Q29udHJvbGxlclxuKSB7XG4gIGxldCB0b3RhbCA9ICcnO1xuICBsZXQgbGFzdEVtaXR0ZWQgPSAnJztcblxuICBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHJlc3ApIHtcbiAgICBjb25zdCBwaWVjZSA9IGdldFRleHRGcm9tQ2h1bmsoY2h1bmspO1xuICAgIGlmICghcGllY2UpIGNvbnRpbnVlO1xuXG4gICAgbGV0IGZyZXNoID0gJyc7XG4gICAgaWYgKHBpZWNlLnN0YXJ0c1dpdGgodG90YWwpKSB7XG4gICAgICAvLyBjdW11bGF0aXZlXG4gICAgICBmcmVzaCA9IHBpZWNlLnNsaWNlKHRvdGFsLmxlbmd0aCk7XG4gICAgICB0b3RhbCA9IHBpZWNlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBkZWx0YSBvciByZXdpbmQg4oCUIGNvbXB1dGUgc2FmZSBzdWZmaXhcbiAgICAgIGNvbnN0IGkgPSBsY3AodG90YWwsIHBpZWNlKTtcbiAgICAgIGZyZXNoID0gcGllY2Uuc2xpY2UoaSk7XG4gICAgICB0b3RhbCA9IHBpZWNlO1xuICAgIH1cblxuICAgIGlmIChmcmVzaCAmJiBmcmVzaCAhPT0gbGFzdEVtaXR0ZWQpIHtcbiAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShgZGF0YTogJHtKU09OLnN0cmluZ2lmeSh7IGRlbHRhOiBmcmVzaCB9KX1cXG5cXG5gKTtcbiAgICAgIGxhc3RFbWl0dGVkID0gZnJlc2g7XG4gICAgfVxuICB9XG59XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tIG1haW4gaGFuZGxlciAtLS0tLS0tLS0tLS0tLS0tLVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuICBjb25zdCB7IG1lc3NhZ2VzLCBmaWx0ZXJTb3VyY2UsIGsgfSA9IEJvZHlTY2hlbWEucGFyc2UoYm9keSk7XG5cbiAgY29uc3QgdXNlckxhc3QgPSBbLi4ubWVzc2FnZXNdLnJldmVyc2UoKS5maW5kKChtKSA9PiBtLnJvbGUgPT09ICd1c2VyJyk/LmNvbnRlbnQgPz8gJyc7XG4gIGNvbnN0IGNvbnRleHQgPSBhd2FpdCByZXRyaWV2ZUNvbnRleHQodXNlckxhc3QsIGZpbHRlclNvdXJjZSwgayk7XG5cbiAgY29uc3Qgc3RyZWFtID0gbmV3IFJlYWRhYmxlU3RyZWFtKHtcbiAgICBhc3luYyBzdGFydChjb250cm9sbGVyKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBBIHNpbmdsZSBjbGVhbiB1c2VyIG1lc3NhZ2UgdGhhdCBjYXJyaWVzIHBvbGljeSArIGNvbnRleHQgKyBxdWVzdGlvbi5cbiAgICAgICAgY29uc3QgY29udGVudHMgPSBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgcGFydHM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRleHQ6IGBQT0xJQ1k6XG4ke1NZU1RFTX1cblxuQ09OVEVYVCAoUkFHKTpcbiR7Y29udGV4dCB8fCAnKG5vbmUpJ31cblxuVVNFUjpcbiR7dXNlckxhc3R9YCxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXTtcblxuICAgICAgICAvLyBUb29sIGRlY2xhcmF0aW9ucyAoZGJTZWxlY3QgKyBleGlzdGluZyBza2lsbC9hbGlnbm1lbnQgdG9vbHMpXG4gICAgICAgIGNvbnN0IHRvb2xzID0gW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uRGVjbGFyYXRpb25zOiBbXG4gICAgICAgICAgICAgIC8vIEdlbmVyaWMgREIgKHRva2VuLW9wdGltaXplZClcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdkYlNlbGVjdCcsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgICAgICAgICAnUmVhZCB3aGl0ZWxpc3RlZCB0YWJsZXMgd2l0aCBmaWx0ZXJzLiBSZXR1cm5zIGEgY29tcGFjdCBzdW1tYXJ5IGFuZCBzbWFsbCBzYW1wbGUgdG8gc2F2ZSB0b2tlbnMuJyxcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzSnNvblNjaGVtYToge1xuICAgICAgICAgICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IHsgdHlwZTogJ2FycmF5JywgaXRlbXM6IHsgdHlwZTogJ3N0cmluZycgfSB9LFxuICAgICAgICAgICAgICAgICAgICBlcToge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxQcm9wZXJ0aWVzOiB7IGFueU9mOiBbeyB0eXBlOiAnc3RyaW5nJyB9LCB7IHR5cGU6ICdudW1iZXInIH1dIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGlsaWtlOiB7IHR5cGU6ICdvYmplY3QnLCBhZGRpdGlvbmFsUHJvcGVydGllczogeyB0eXBlOiAnc3RyaW5nJyB9IH0sXG4gICAgICAgICAgICAgICAgICAgIGd0ZToge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxQcm9wZXJ0aWVzOiB7IGFueU9mOiBbeyB0eXBlOiAnc3RyaW5nJyB9LCB7IHR5cGU6ICdudW1iZXInIH1dIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGx0ZToge1xuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxQcm9wZXJ0aWVzOiB7IGFueU9mOiBbeyB0eXBlOiAnc3RyaW5nJyB9LCB7IHR5cGU6ICdudW1iZXInIH1dIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgICAgICAgZGVzYzogeyB0eXBlOiAnYm9vbGVhbicgfSxcbiAgICAgICAgICAgICAgICAgICAgbGltaXQ6IHsgdHlwZTogJ251bWJlcicsIG1pbmltdW06IDEsIG1heGltdW06IDUwIH0sXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldDogeyB0eXBlOiAnbnVtYmVyJywgbWluaW11bTogMCwgbWF4aW11bTogNTAwMCB9LFxuICAgICAgICAgICAgICAgICAgICBzYW1wbGVTaXplOiB7IHR5cGU6ICdudW1iZXInLCBtaW5pbXVtOiAwLCBtYXhpbXVtOiAyNSB9LFxuICAgICAgICAgICAgICAgICAgICBtb2RlOiB7IHR5cGU6ICdzdHJpbmcnLCBlbnVtOiBbJ3N1bW1hcnknLCAncm93cyddIH0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFsndGFibGUnXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgIC8vIEtQSXNcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdnZXRMYXRlc3RLUElzJyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1JldHVybiBkYXNoYm9hcmQgS1BJIHNuYXBzaG90LicsXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyc0pzb25TY2hlbWE6IHsgdHlwZTogJ29iamVjdCcsIHByb3BlcnRpZXM6IHt9IH0sXG4gICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgLy8gU2tpbGxzICYgYWxpZ25tZW50IChEQi1iYWNrZWQpXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZ2V0VG9wSW5EZW1hbmRTa2lsbHMnLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVG9wIGluLWRlbWFuZCBza2lsbHMgZnJvbSByZWNlbnQgam9iIHBvc3RpbmdzLicsXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyc0pzb25TY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3dEYXlzOiB7IHR5cGU6ICdudW1iZXInLCBtaW5pbXVtOiAxLCBtYXhpbXVtOiAzNjUgfSxcbiAgICAgICAgICAgICAgICAgICAgbGltaXQ6IHsgdHlwZTogJ251bWJlcicsIG1pbmltdW06IDEsIG1heGltdW06IDEwMCB9LFxuICAgICAgICAgICAgICAgICAgICBtaW5Db3VudDogeyB0eXBlOiAnbnVtYmVyJywgbWluaW11bTogMCwgbWF4aW11bTogMTAwMDAgfSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdnZXRDb3Vyc2VTa2lsbENvdmVyYWdlJyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1NraWxscyBhIGNvdXJzZSB0ZWFjaGVzIGFuZCBob3cgdGhleSBvdmVybGFwIHdpdGggbWFya2V0IGRlbWFuZC4nLFxuICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNKc29uU2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgY291cnNlSWQ6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgICAgICAgd2luZG93RGF5czogeyB0eXBlOiAnbnVtYmVyJywgbWluaW11bTogMSwgbWF4aW11bTogMzY1IH0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFsnY291cnNlSWQnXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2dldE1pc3NpbmdTa2lsbHNGb3JDb3Vyc2UnLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnSW4tZGVtYW5kIHNraWxscyB0aGF0IGEgY291cnNlIGRvZXMgbm90IGNvdmVyLicsXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyc0pzb25TY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBjb3Vyc2VJZDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICAgICAgICB3aW5kb3dEYXlzOiB7IHR5cGU6ICdudW1iZXInLCBtaW5pbXVtOiAxLCBtYXhpbXVtOiAzNjUgfSxcbiAgICAgICAgICAgICAgICAgICAgbWluQ291bnQ6IHsgdHlwZTogJ251bWJlcicsIG1pbmltdW06IDAsIG1heGltdW06IDEwMDAwIH0sXG4gICAgICAgICAgICAgICAgICAgIGxpbWl0OiB7IHR5cGU6ICdudW1iZXInLCBtaW5pbXVtOiAxLCBtYXhpbXVtOiAyMDAgfSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogWydjb3Vyc2VJZCddLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZ2V0QWxpZ25tZW50U3VtbWFyeScsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdBdmVyYWdlIGFsaWdubWVudCBzY29yZXMgZm9yIGEgY291cnNlIG9yIGFjcm9zcyBjb3Vyc2VzLicsXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyc0pzb25TY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBjb3Vyc2VJZDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICAgICAgICB3aW5kb3dEYXlzOiB7IHR5cGU6ICdudW1iZXInLCBtaW5pbXVtOiAxLCBtYXhpbXVtOiAzNjUgfSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAvLyBPcHRpb25hbCBkYXRhU2VydmljZS1iYWNrZWQgdmFyaWFudHNcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdnZXRJbkRlbWFuZFNraWxsc1ZpYVNlcnZpY2UnLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVXNlIGRhdGFTZXJ2aWNlLnRzIChpZiBhdmFpbGFibGUpIHRvIGNvbXB1dGUgaW4tZGVtYW5kIHNraWxscy4nLFxuICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNKc29uU2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93RGF5czogeyB0eXBlOiAnbnVtYmVyJywgbWluaW11bTogMSwgbWF4aW11bTogMzY1IH0sXG4gICAgICAgICAgICAgICAgICAgIGxpbWl0OiB7IHR5cGU6ICdudW1iZXInLCBtaW5pbXVtOiAxLCBtYXhpbXVtOiAxMDAgfSxcbiAgICAgICAgICAgICAgICAgICAgbWluQ291bnQ6IHsgdHlwZTogJ251bWJlcicsIG1pbmltdW06IDAsIG1heGltdW06IDEwMDAwIH0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZ2V0Q291cnNlU2tpbGxDb3ZlcmFnZVZpYVNlcnZpY2UnLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVXNlIGRhdGFTZXJ2aWNlLnRzIChpZiBhdmFpbGFibGUpIHRvIGNvbXB1dGUgY291cnNlIHNraWxsIGNvdmVyYWdlLicsXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyc0pzb25TY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBjb3Vyc2VJZDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICAgICAgICB3aW5kb3dEYXlzOiB7IHR5cGU6ICdudW1iZXInLCBtaW5pbXVtOiAxLCBtYXhpbXVtOiAzNjUgfSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICByZXF1aXJlZDogWydjb3Vyc2VJZCddLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZ2V0TWlzc2luZ1NraWxsc0ZvckNvdXJzZVZpYVNlcnZpY2UnLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICAgICAgJ1VzZSBkYXRhU2VydmljZS50cyAoaWYgYXZhaWxhYmxlKSB0byBjb21wdXRlIG1pc3Npbmcgc2tpbGxzIGZvciBhIGNvdXJzZS4nLFxuICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNKc29uU2NoZW1hOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgY291cnNlSWQ6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgICAgICAgd2luZG93RGF5czogeyB0eXBlOiAnbnVtYmVyJywgbWluaW11bTogMSwgbWF4aW11bTogMzY1IH0sXG4gICAgICAgICAgICAgICAgICAgIG1pbkNvdW50OiB7IHR5cGU6ICdudW1iZXInLCBtaW5pbXVtOiAwLCBtYXhpbXVtOiAxMDAwMCB9LFxuICAgICAgICAgICAgICAgICAgICBsaW1pdDogeyB0eXBlOiAnbnVtYmVyJywgbWluaW11bTogMSwgbWF4aW11bTogMjAwIH0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFsnY291cnNlSWQnXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICBdO1xuXG4gICAgICAgIC8vIDEpIFByb2JlIGZvciB0b29sIGNhbGwgKG5vbi1zdHJlYW0pXG4gICAgICAgIGNvbnN0IGZpcnN0ID0gYXdhaXQgYWkubW9kZWxzLmdlbmVyYXRlQ29udGVudCh7XG4gICAgICAgICAgbW9kZWw6IHByb2Nlc3MuZW52LkNBUkxZX01PREVMIHx8ICdnZW1pbmktMi41LWZsYXNoJyxcbiAgICAgICAgICBjb250ZW50cyxcbiAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgIHRvb2xzLFxuICAgICAgICAgICAgdG9vbENvbmZpZzogeyBmdW5jdGlvbkNhbGxpbmdDb25maWc6IHsgbW9kZTogRnVuY3Rpb25DYWxsaW5nQ29uZmlnTW9kZS5BVVRPIH0gfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBmdW5jdGlvbkNhbGxzID0gKGZpcnN0IGFzIGFueSkuZnVuY3Rpb25DYWxscyBhc1xuICAgICAgICAgIHwgeyBuYW1lOiBzdHJpbmc7IGFyZ3M/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+IH1bXVxuICAgICAgICAgIHwgdW5kZWZpbmVkO1xuXG4gICAgICAgIGlmIChmdW5jdGlvbkNhbGxzPy5sZW5ndGgpIHtcbiAgICAgICAgICAvLyBUb29sIGNhbGwgcGF0aFxuICAgICAgICAgIGNvbnN0IGNhbGwgPSBmdW5jdGlvbkNhbGxzWzBdO1xuICAgICAgICAgIGxldCByZXN1bHQ6IGFueSA9IHt9O1xuXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHN3aXRjaCAoY2FsbC5uYW1lKSB7XG4gICAgICAgICAgICAgIC8vIEdlbmVyaWMgREJcbiAgICAgICAgICAgICAgICBjYXNlICdkYlNlbGVjdCc6IHtcbiAgICAgICAgICAgICAgICBpZiAoIWNhbGwuYXJncyB8fCB0eXBlb2YgY2FsbC5hcmdzLnRhYmxlICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB7IG9rOiBmYWxzZSwgZXJyb3I6ICdkYlNlbGVjdDogbWlzc2luZyByZXF1aXJlZCBcInRhYmxlXCIgYXJndW1lbnQnIH07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBTYWZlIHRvIGNhc3QgYWZ0ZXIgdGhlIGd1YXJkXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgZGJTZWxlY3RPcHRpbWl6ZWQoY2FsbC5hcmdzIGFzIGFueSAvKiBhcyBEYlNlbGVjdEFyZ3MgKi8pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvLyBLUElzXG4gICAgICAgICAgICAgIGNhc2UgJ2dldExhdGVzdEtQSXMnOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IGdldExhdGVzdEtQSXMoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAvLyBTa2lsbHMgKERCLWJhY2tlZClcbiAgICAgICAgICAgICAgY2FzZSAnZ2V0VG9wSW5EZW1hbmRTa2lsbHMnOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IGdldFRvcEluRGVtYW5kU2tpbGxzKHtcbiAgICAgICAgICAgICAgICAgIHdpbmRvd0RheXM6IGNhbGwuYXJncz8ud2luZG93RGF5cyxcbiAgICAgICAgICAgICAgICAgIGxpbWl0OiBjYWxsLmFyZ3M/LmxpbWl0LFxuICAgICAgICAgICAgICAgICAgbWluQ291bnQ6IGNhbGwuYXJncz8ubWluQ291bnQsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ2dldENvdXJzZVNraWxsQ292ZXJhZ2UnOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IGdldENvdXJzZVNraWxsQ292ZXJhZ2Uoe1xuICAgICAgICAgICAgICAgICAgY291cnNlSWQ6IFN0cmluZyhjYWxsLmFyZ3M/LmNvdXJzZUlkID8/ICcnKSxcbiAgICAgICAgICAgICAgICAgIHdpbmRvd0RheXM6IGNhbGwuYXJncz8ud2luZG93RGF5cyxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnZ2V0TWlzc2luZ1NraWxsc0ZvckNvdXJzZSc6XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgZ2V0TWlzc2luZ1NraWxsc0ZvckNvdXJzZSh7XG4gICAgICAgICAgICAgICAgICBjb3Vyc2VJZDogU3RyaW5nKGNhbGwuYXJncz8uY291cnNlSWQgPz8gJycpLFxuICAgICAgICAgICAgICAgICAgd2luZG93RGF5czogY2FsbC5hcmdzPy53aW5kb3dEYXlzLFxuICAgICAgICAgICAgICAgICAgbWluQ291bnQ6IGNhbGwuYXJncz8ubWluQ291bnQsXG4gICAgICAgICAgICAgICAgICBsaW1pdDogY2FsbC5hcmdzPy5saW1pdCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnZ2V0QWxpZ25tZW50U3VtbWFyeSc6XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgZ2V0QWxpZ25tZW50U3VtbWFyeSh7XG4gICAgICAgICAgICAgICAgICBjb3Vyc2VJZDogY2FsbC5hcmdzPy5jb3Vyc2VJZCxcbiAgICAgICAgICAgICAgICAgIHdpbmRvd0RheXM6IGNhbGwuYXJncz8ud2luZG93RGF5cyxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAvLyBkYXRhU2VydmljZS1iYWNrZWQgdmFyaWFudHNcbiAgICAgICAgICAgICAgY2FzZSAnZ2V0SW5EZW1hbmRTa2lsbHNWaWFTZXJ2aWNlJzpcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCBnZXRJbkRlbWFuZFNraWxsc1ZpYVNlcnZpY2Uoe1xuICAgICAgICAgICAgICAgICAgd2luZG93RGF5czogY2FsbC5hcmdzPy53aW5kb3dEYXlzLFxuICAgICAgICAgICAgICAgICAgbGltaXQ6IGNhbGwuYXJncz8ubGltaXQsXG4gICAgICAgICAgICAgICAgICBtaW5Db3VudDogY2FsbC5hcmdzPy5taW5Db3VudCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnZ2V0Q291cnNlU2tpbGxDb3ZlcmFnZVZpYVNlcnZpY2UnOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IGdldENvdXJzZVNraWxsQ292ZXJhZ2VWaWFTZXJ2aWNlKHtcbiAgICAgICAgICAgICAgICAgIGNvdXJzZUlkOiBTdHJpbmcoY2FsbC5hcmdzPy5jb3Vyc2VJZCA/PyAnJyksXG4gICAgICAgICAgICAgICAgICB3aW5kb3dEYXlzOiBjYWxsLmFyZ3M/LndpbmRvd0RheXMsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ2dldE1pc3NpbmdTa2lsbHNGb3JDb3Vyc2VWaWFTZXJ2aWNlJzpcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCBnZXRNaXNzaW5nU2tpbGxzRm9yQ291cnNlVmlhU2VydmljZSh7XG4gICAgICAgICAgICAgICAgICBjb3Vyc2VJZDogU3RyaW5nKGNhbGwuYXJncz8uY291cnNlSWQgPz8gJycpLFxuICAgICAgICAgICAgICAgICAgd2luZG93RGF5czogY2FsbC5hcmdzPy53aW5kb3dEYXlzLFxuICAgICAgICAgICAgICAgICAgbWluQ291bnQ6IGNhbGwuYXJncz8ubWluQ291bnQsXG4gICAgICAgICAgICAgICAgICBsaW1pdDogY2FsbC5hcmdzPy5saW1pdCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHsgb2s6IGZhbHNlLCBlcnJvcjogYFVua25vd24gdG9vbDogJHtjYWxsLm5hbWV9YCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICAgICAgcmVzdWx0ID0geyBvazogZmFsc2UsIGVycm9yOiBlPy5tZXNzYWdlIHx8IFN0cmluZyhlKSB9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IG5ld0NvbnRlbnRzID0gW1xuICAgICAgICAgICAgLi4uY29udGVudHMsIC8vIGRvIE5PVCBzcHJlYWQgbW9kZWwtd3JpdHRlbiBjb250ZW50c1xuICAgICAgICAgICAgeyByb2xlOiAndG9vbCcsIHBhcnRzOiBbeyBmdW5jdGlvblJlc3BvbnNlOiB7IG5hbWU6IGNhbGwubmFtZSwgcmVzcG9uc2U6IHJlc3VsdCB9IH1dIH0sXG4gICAgICAgICAgXTtcblxuICAgICAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBhaS5tb2RlbHMuZ2VuZXJhdGVDb250ZW50U3RyZWFtKHtcbiAgICAgICAgICAgIG1vZGVsOiBwcm9jZXNzLmVudi5DQVJMWV9NT0RFTCB8fCAnZ2VtaW5pLTIuNS1mbGFzaCcsXG4gICAgICAgICAgICBjb250ZW50czogbmV3Q29udGVudHMsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBhd2FpdCBwaXBlTW9kZWxTdHJlYW1Ub1NTRShyZXNwLCBjb250cm9sbGVyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBObyB0b29sIGNhbGwg4oCUIHN0cmVhbSB0aGUgYW5zd2VyXG4gICAgICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IGFpLm1vZGVscy5nZW5lcmF0ZUNvbnRlbnRTdHJlYW0oe1xuICAgICAgICAgICAgbW9kZWw6IHByb2Nlc3MuZW52LkNBUkxZX01PREVMIHx8ICdnZW1pbmktMi41LWZsYXNoJyxcbiAgICAgICAgICAgIGNvbnRlbnRzLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGF3YWl0IHBpcGVNb2RlbFN0cmVhbVRvU1NFKHJlc3AsIGNvbnRyb2xsZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKGBldmVudDogZG9uZVxcbmRhdGE6IHt9XFxuXFxuYCk7XG4gICAgICAgIGNvbnRyb2xsZXIuY2xvc2UoKTtcbiAgICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FQSSBFcnJvcjonLCBlcnIpO1xuICAgICAgICBjb250cm9sbGVyLmVucXVldWUoYGV2ZW50OiBlcnJvclxcbmRhdGE6ICR7SlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogZXJyLm1lc3NhZ2UgfSl9XFxuXFxuYCk7XG4gICAgICAgIGNvbnRyb2xsZXIuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9LFxuICB9KTtcblxuICByZXR1cm4gbmV3IFJlc3BvbnNlKHN0cmVhbSwge1xuICAgIGhlYWRlcnM6IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAndGV4dC9ldmVudC1zdHJlYW07IGNoYXJzZXQ9dXRmLTgnLFxuICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAnbm8tY2FjaGUsIG5vLXRyYW5zZm9ybScsXG4gICAgICBDb25uZWN0aW9uOiAna2VlcC1hbGl2ZScsXG4gICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonLFxuICAgICAgJ1gtQWNjZWwtQnVmZmVyaW5nJzogJ25vJywgLy8gaGVscHMgb24gc29tZSBwcm94aWVzL0NETnNcbiAgICB9LFxuICB9KTtcbn1cbiJdLCJuYW1lcyI6WyJHb29nbGVHZW5BSSIsIkZ1bmN0aW9uQ2FsbGluZ0NvbmZpZ01vZGUiLCJjcmVhdGVDbGllbnQiLCJ6IiwiZ2V0TGF0ZXN0S1BJcyIsImdldFRvcEluRGVtYW5kU2tpbGxzIiwiZ2V0Q291cnNlU2tpbGxDb3ZlcmFnZSIsImdldE1pc3NpbmdTa2lsbHNGb3JDb3Vyc2UiLCJnZXRBbGlnbm1lbnRTdW1tYXJ5IiwiZ2V0SW5EZW1hbmRTa2lsbHNWaWFTZXJ2aWNlIiwiZ2V0Q291cnNlU2tpbGxDb3ZlcmFnZVZpYVNlcnZpY2UiLCJnZXRNaXNzaW5nU2tpbGxzRm9yQ291cnNlVmlhU2VydmljZSIsImRiU2VsZWN0T3B0aW1pemVkIiwicnVudGltZSIsImR5bmFtaWMiLCJhaSIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJHRU1JTklfQVBJX0tFWSIsImdldFN1cGFBZG1pbiIsInVybCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsImtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJFcnJvciIsImF1dGgiLCJwZXJzaXN0U2Vzc2lvbiIsIkJvZHlTY2hlbWEiLCJvYmplY3QiLCJtZXNzYWdlcyIsImFycmF5Iiwicm9sZSIsImVudW0iLCJjb250ZW50Iiwic3RyaW5nIiwiZmlsdGVyU291cmNlIiwib3B0aW9uYWwiLCJrIiwibnVtYmVyIiwiZW1iZWRRdWVyeSIsInEiLCJyZXMiLCJtb2RlbHMiLCJlbWJlZENvbnRlbnQiLCJtb2RlbCIsImNvbnRlbnRzIiwiY29uZmlnIiwidGFza1R5cGUiLCJvdXRwdXREaW1lbnNpb25hbGl0eSIsImVtYmVkZGluZ3MiLCJ2YWx1ZXMiLCJyZXRyaWV2ZUNvbnRleHQiLCJxdWVyeVRleHQiLCJxVmVjIiwic3VwYSIsImRhdGEiLCJlcnJvciIsInJwYyIsInF1ZXJ5X2VtYmVkZGluZyIsIm1hdGNoX2NvdW50IiwiZmlsdGVyX3NvdXJjZSIsIm1hcCIsImQiLCJzb3VyY2UiLCJ0aXRsZSIsImpvaW4iLCJTWVNURU0iLCJDQVJMWV9OQU1FIiwidHJpbSIsImxjcCIsImEiLCJiIiwibiIsIk1hdGgiLCJtaW4iLCJsZW5ndGgiLCJpIiwiY2hhckNvZGVBdCIsImdldFRleHRGcm9tQ2h1bmsiLCJjIiwidGV4dCIsImRlbHRhIiwiY2FuZCIsImNhbmRpZGF0ZXNDaHVuayIsImNhbmRpZGF0ZXMiLCJwYXJ0cyIsInAiLCJBcnJheSIsImlzQXJyYXkiLCJ4IiwicGlwZU1vZGVsU3RyZWFtVG9TU0UiLCJyZXNwIiwiY29udHJvbGxlciIsInRvdGFsIiwibGFzdEVtaXR0ZWQiLCJjaHVuayIsInBpZWNlIiwiZnJlc2giLCJzdGFydHNXaXRoIiwic2xpY2UiLCJlbnF1ZXVlIiwiSlNPTiIsInN0cmluZ2lmeSIsIlBPU1QiLCJyZXEiLCJib2R5IiwianNvbiIsInBhcnNlIiwidXNlckxhc3QiLCJyZXZlcnNlIiwiZmluZCIsIm0iLCJjb250ZXh0Iiwic3RyZWFtIiwiUmVhZGFibGVTdHJlYW0iLCJzdGFydCIsInRvb2xzIiwiZnVuY3Rpb25EZWNsYXJhdGlvbnMiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJwYXJhbWV0ZXJzSnNvblNjaGVtYSIsInR5cGUiLCJwcm9wZXJ0aWVzIiwidGFibGUiLCJjb2x1bW5zIiwiaXRlbXMiLCJlcSIsImFkZGl0aW9uYWxQcm9wZXJ0aWVzIiwiYW55T2YiLCJpbGlrZSIsImd0ZSIsImx0ZSIsIm9yZGVyQnkiLCJkZXNjIiwibGltaXQiLCJtaW5pbXVtIiwibWF4aW11bSIsIm9mZnNldCIsInNhbXBsZVNpemUiLCJtb2RlIiwicmVxdWlyZWQiLCJ3aW5kb3dEYXlzIiwibWluQ291bnQiLCJjb3Vyc2VJZCIsImZpcnN0IiwiZ2VuZXJhdGVDb250ZW50IiwiQ0FSTFlfTU9ERUwiLCJ0b29sQ29uZmlnIiwiZnVuY3Rpb25DYWxsaW5nQ29uZmlnIiwiQVVUTyIsImZ1bmN0aW9uQ2FsbHMiLCJjYWxsIiwicmVzdWx0IiwiYXJncyIsIm9rIiwiU3RyaW5nIiwiZSIsIm1lc3NhZ2UiLCJuZXdDb250ZW50cyIsImZ1bmN0aW9uUmVzcG9uc2UiLCJyZXNwb25zZSIsImdlbmVyYXRlQ29udGVudFN0cmVhbSIsImNsb3NlIiwiZXJyIiwiY29uc29sZSIsIlJlc3BvbnNlIiwiaGVhZGVycyIsIkNvbm5lY3Rpb24iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/carly/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/app/api/carly/tools.ts":
/*!************************************!*\
  !*** ./src/app/api/carly/tools.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAlignmentSummary: () => (/* binding */ getAlignmentSummary),\n/* harmony export */   getCourseSkillCoverage: () => (/* binding */ getCourseSkillCoverage),\n/* harmony export */   getCourseSkillCoverageViaService: () => (/* binding */ getCourseSkillCoverageViaService),\n/* harmony export */   getInDemandSkillsViaService: () => (/* binding */ getInDemandSkillsViaService),\n/* harmony export */   getLatestKPIs: () => (/* binding */ getLatestKPIs),\n/* harmony export */   getMissingSkillsForCourse: () => (/* binding */ getMissingSkillsForCourse),\n/* harmony export */   getMissingSkillsForCourseViaService: () => (/* binding */ getMissingSkillsForCourseViaService),\n/* harmony export */   getTopInDemandSkills: () => (/* binding */ getTopInDemandSkills)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// api/carly/tools.ts\n\nfunction getSupaAdmin() {\n    const url = \"https://swiuodmiiuqausjombgm.supabase.co\";\n    const key = process.env.SUPABASE_SERVICE_ROLE_KEY; // server-only\n    if (!url) throw new Error('Missing env: NEXT_PUBLIC_SUPABASE_URL');\n    if (!key) throw new Error('Missing env: SUPABASE_SERVICE_ROLE_KEY');\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, key, {\n        auth: {\n            persistSession: false\n        }\n    });\n}\n/** Existing */ async function getLatestKPIs() {\n    const supa = getSupaAdmin();\n    const [jobsHead, coursesHead, scoresRes] = await Promise.all([\n        supa.from('jobs').select('*', {\n            head: true,\n            count: 'exact'\n        }),\n        supa.from('courses').select('*', {\n            head: true,\n            count: 'exact'\n        }),\n        supa.from('course_alignment_scores').select('score').order('calculated_at', {\n            ascending: false\n        }).limit(100)\n    ]);\n    if (jobsHead.error) throw new Error(`jobs: ${jobsHead.error.message || 'unknown error'}`);\n    if (coursesHead.error) throw new Error(`courses: ${coursesHead.error.message || 'unknown error'}`);\n    if (scoresRes.error) throw new Error(`course_alignment_scores: ${scoresRes.error.message || 'unknown error'}`);\n    const job_count = jobsHead.count ?? 0;\n    const course_count = coursesHead.count ?? 0;\n    const scores = scoresRes.data ?? [];\n    const avg = scores.reduce((a, b)=>a + (b?.score ?? 0), 0) / Math.max(scores.length, 1);\n    return {\n        job_count,\n        course_count,\n        latest_alignment_avg: Number.isFinite(avg) ? Number(avg.toFixed(2)) : 0,\n        _source: 'supabase'\n    };\n}\n/* -------------------------------------------------------------------------- */ /*                                SKILLS TOOLS                                */ /* -------------------------------------------------------------------------- */ /**\n * Top in-demand skills from job_skills over a recent window.\n * Assumes job_skills(skill text, job_id uuid, created_at timestamptz?) and jobs(id, created_at).\n */ async function getTopInDemandSkills(opts) {\n    const supa = getSupaAdmin();\n    const windowDays = Math.max(1, Math.min(365, opts?.windowDays ?? 30));\n    const limit = Math.max(1, Math.min(100, opts?.limit ?? 25));\n    const minCount = Math.max(0, opts?.minCount ?? 0);\n    // Prefer an RPC (faster & cleaner). If you add this in DB, uncomment the RPC block and remove fallback.\n    const rpcTry = await supa.rpc('top_in_demand_skills', {\n        window_days: windowDays,\n        top_limit: limit,\n        min_count: minCount\n    });\n    if (!rpcTry.error && rpcTry.data) {\n        return {\n            ok: true,\n            items: rpcTry.data,\n            via: 'rpc'\n        };\n    }\n    // Fallback: do it with PostgREST filters (may be slower on large tables).\n    // We count skills on jobs created in the window. Adjust column names if needed.\n    const sinceISO = new Date(Date.now() - windowDays * 86400000).toISOString();\n    // Pull skill counts keyed by skill. If you have a materialized view, use that instead.\n    const res = await supa.from('job_skills').select('skill, jobs!inner(created_at)').gte('jobs.created_at', sinceISO);\n    if (res.error) throw new Error(`job_skills: ${res.error.message || 'unknown error'}`);\n    const counts = new Map();\n    for (const row of res.data ?? []){\n        const s = (row.skill ?? '').trim();\n        if (!s) continue;\n        counts.set(s, (counts.get(s) ?? 0) + 1);\n    }\n    const items = [\n        ...counts.entries()\n    ].map(([skill, count])=>({\n            skill,\n            count\n        })).filter((r)=>r.count >= minCount).sort((a, b)=>b.count - a.count).slice(0, limit);\n    return {\n        ok: true,\n        items,\n        via: 'fallback'\n    };\n}\n/**\n * Skills a course teaches, and how those overlap with current demand.\n * Assumes course_skills(course_id uuid, skill text)\n */ async function getCourseSkillCoverage(opts) {\n    const supa = getSupaAdmin();\n    const { courseId } = opts;\n    const windowDays = Math.max(1, Math.min(365, opts?.windowDays ?? 30));\n    // 1) course skills\n    const cs = await supa.from('course_skills').select('skill').eq('course_id', courseId);\n    if (cs.error) throw new Error(`course_skills: ${cs.error.message || 'unknown error'}`);\n    const taught = new Set((cs.data ?? []).map((r)=>(r.skill ?? '').trim()).filter(Boolean));\n    // 2) top demand\n    const top = await getTopInDemandSkills({\n        windowDays,\n        limit: 200\n    });\n    const demandSet = new Set((top.items ?? []).map((r)=>r.skill));\n    const covered = [\n        ...taught\n    ].filter((s)=>demandSet.has(s));\n    const missing = [\n        ...demandSet\n    ].filter((s)=>!taught.has(s));\n    const coveragePct = taught.size ? Number((covered.length / taught.size * 100).toFixed(1)) : 0;\n    return {\n        ok: true,\n        courseId,\n        counts: {\n            taught: taught.size,\n            covered: covered.length,\n            missing: missing.length\n        },\n        coveragePct,\n        coveredSkills: covered,\n        missingSkills: missing\n    };\n}\n/**\n * Missing in-demand skills for a specific course (with thresholds).\n */ async function getMissingSkillsForCourse(opts) {\n    const { courseId } = opts;\n    const windowDays = Math.max(1, Math.min(365, opts?.windowDays ?? 30));\n    const minCount = Math.max(0, opts?.minCount ?? 3);\n    const limit = Math.max(1, Math.min(200, opts?.limit ?? 50));\n    const [coverage, top] = await Promise.all([\n        getCourseSkillCoverage({\n            courseId,\n            windowDays\n        }),\n        getTopInDemandSkills({\n            windowDays,\n            limit: 500,\n            minCount\n        })\n    ]);\n    const missingRanked = (top.items ?? []).filter((r)=>(coverage.missingSkills ?? []).includes(r.skill)).slice(0, limit);\n    return {\n        ok: true,\n        courseId,\n        missing: missingRanked,\n        coveragePct: coverage.coveragePct\n    };\n}\n/**\n * Alignment summary for a course or globally.\n * Assumes course_alignment_scores(course_id, score, calculated_at)\n */ async function getAlignmentSummary(opts) {\n    const supa = getSupaAdmin();\n    const windowDays = Math.max(1, Math.min(365, opts?.windowDays ?? 90));\n    const sinceISO = new Date(Date.now() - windowDays * 86400000).toISOString();\n    let q = supa.from('course_alignment_scores').select('course_id,score,calculated_at').gte('calculated_at', sinceISO).order('calculated_at', {\n        ascending: false\n    });\n    if (opts?.courseId) q = q.eq('course_id', opts.courseId);\n    const res = await q;\n    if (res.error) throw new Error(`course_alignment_scores: ${res.error.message || 'unknown error'}`);\n    const rows = res.data ?? [];\n    if (opts?.courseId) {\n        const avg = rows.reduce((a, r)=>a + (r.score ?? 0), 0) / Math.max(rows.length, 1);\n        return {\n            ok: true,\n            courseId: opts.courseId,\n            avg: Number(avg.toFixed(2)),\n            n: rows.length\n        };\n    }\n    // global per-course avg\n    const map = new Map();\n    for (const r of rows){\n        const k = String(r.course_id ?? '');\n        const m = map.get(k) ?? {\n            sum: 0,\n            n: 0\n        };\n        m.sum += r.score ?? 0;\n        m.n += 1;\n        map.set(k, m);\n    }\n    const items = [\n        ...map.entries()\n    ].map(([courseId, { sum, n }])=>({\n            courseId,\n            avg: Number((sum / Math.max(n, 1)).toFixed(2)),\n            n\n        }));\n    items.sort((a, b)=>b.avg - a.avg);\n    return {\n        ok: true,\n        items\n    };\n}\nasync function tryLoadDataService() {\n    try {\n        const mod = await __webpack_require__.e(/*! import() */ \"_rsc_src_lib_dataService_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ../../../lib/dataService */ \"(rsc)/./src/lib/dataService.ts\"));\n        return mod;\n    } catch  {\n        return null;\n    }\n}\nasync function getInDemandSkillsViaService(opts) {\n    const svc = await tryLoadDataService();\n    if (svc?.getInDemandSkills) return svc.getInDemandSkills(opts ?? {});\n    // Fallback to our DB method\n    return getTopInDemandSkills(opts);\n}\nasync function getMissingSkillsForCourseViaService(opts) {\n    const svc = await tryLoadDataService();\n    if (svc?.getMissingSkillsForCourse) return svc.getMissingSkillsForCourse(opts);\n    return getMissingSkillsForCourse(opts);\n}\nasync function getCourseSkillCoverageViaService(opts) {\n    const svc = await tryLoadDataService();\n    if (svc?.getCourseSkillCoverage) return svc.getCourseSkillCoverage(opts);\n    return getCourseSkillCoverage(opts);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c3RhbC9Eb2N1bWVudHMvUHJvamVjdHMvY3VycmljYWxpZ24vZnJvbnRlbmQvc3JjL2FwcC9hcGkvY2FybHkvdG9vbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gYXBpL2Nhcmx5L3Rvb2xzLnRzXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG5mdW5jdGlvbiBnZXRTdXBhQWRtaW4oKSB7XG4gIGNvbnN0IHVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgY29uc3Qga2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTsgLy8gc2VydmVyLW9ubHlcbiAgaWYgKCF1cmwpIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBlbnY6IE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCcpO1xuICBpZiAoIWtleSkgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIGVudjogU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWScpO1xuICByZXR1cm4gY3JlYXRlQ2xpZW50KHVybCwga2V5LCB7IGF1dGg6IHsgcGVyc2lzdFNlc3Npb246IGZhbHNlIH0gfSk7XG59XG5cbi8qKiBFeGlzdGluZyAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldExhdGVzdEtQSXMoKSB7XG4gIGNvbnN0IHN1cGEgPSBnZXRTdXBhQWRtaW4oKTtcbiAgY29uc3QgW2pvYnNIZWFkLCBjb3Vyc2VzSGVhZCwgc2NvcmVzUmVzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICBzdXBhLmZyb20oJ2pvYnMnKS5zZWxlY3QoJyonLCB7IGhlYWQ6IHRydWUsIGNvdW50OiAnZXhhY3QnIH0pLFxuICAgIHN1cGEuZnJvbSgnY291cnNlcycpLnNlbGVjdCgnKicsIHsgaGVhZDogdHJ1ZSwgY291bnQ6ICdleGFjdCcgfSksXG4gICAgc3VwYVxuICAgICAgLmZyb20oJ2NvdXJzZV9hbGlnbm1lbnRfc2NvcmVzJylcbiAgICAgIC5zZWxlY3QoJ3Njb3JlJylcbiAgICAgIC5vcmRlcignY2FsY3VsYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgLmxpbWl0KDEwMCksXG4gIF0pO1xuICBpZiAoam9ic0hlYWQuZXJyb3IpIHRocm93IG5ldyBFcnJvcihgam9iczogJHtqb2JzSGVhZC5lcnJvci5tZXNzYWdlIHx8ICd1bmtub3duIGVycm9yJ31gKTtcbiAgaWYgKGNvdXJzZXNIZWFkLmVycm9yKSB0aHJvdyBuZXcgRXJyb3IoYGNvdXJzZXM6ICR7Y291cnNlc0hlYWQuZXJyb3IubWVzc2FnZSB8fCAndW5rbm93biBlcnJvcid9YCk7XG4gIGlmIChzY29yZXNSZXMuZXJyb3IpIHRocm93IG5ldyBFcnJvcihgY291cnNlX2FsaWdubWVudF9zY29yZXM6ICR7c2NvcmVzUmVzLmVycm9yLm1lc3NhZ2UgfHwgJ3Vua25vd24gZXJyb3InfWApO1xuXG4gIGNvbnN0IGpvYl9jb3VudCA9IGpvYnNIZWFkLmNvdW50ID8/IDA7XG4gIGNvbnN0IGNvdXJzZV9jb3VudCA9IGNvdXJzZXNIZWFkLmNvdW50ID8/IDA7XG4gIGNvbnN0IHNjb3JlcyA9IHNjb3Jlc1Jlcy5kYXRhID8/IFtdO1xuICBjb25zdCBhdmcgPVxuICAgIHNjb3Jlcy5yZWR1Y2UoKGE6IG51bWJlciwgYjogYW55KSA9PiBhICsgKGI/LnNjb3JlID8/IDApLCAwKSAvIE1hdGgubWF4KHNjb3Jlcy5sZW5ndGgsIDEpO1xuXG4gIHJldHVybiB7XG4gICAgam9iX2NvdW50LFxuICAgIGNvdXJzZV9jb3VudCxcbiAgICBsYXRlc3RfYWxpZ25tZW50X2F2ZzogTnVtYmVyLmlzRmluaXRlKGF2ZykgPyBOdW1iZXIoYXZnLnRvRml4ZWQoMikpIDogMCxcbiAgICBfc291cmNlOiAnc3VwYWJhc2UnLFxuICB9O1xufVxuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNLSUxMUyBUT09MUyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbi8qKlxuICogVG9wIGluLWRlbWFuZCBza2lsbHMgZnJvbSBqb2Jfc2tpbGxzIG92ZXIgYSByZWNlbnQgd2luZG93LlxuICogQXNzdW1lcyBqb2Jfc2tpbGxzKHNraWxsIHRleHQsIGpvYl9pZCB1dWlkLCBjcmVhdGVkX2F0IHRpbWVzdGFtcHR6PykgYW5kIGpvYnMoaWQsIGNyZWF0ZWRfYXQpLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VG9wSW5EZW1hbmRTa2lsbHMob3B0cz86IHsgd2luZG93RGF5cz86IG51bWJlcjsgbGltaXQ/OiBudW1iZXI7IG1pbkNvdW50PzogbnVtYmVyIH0pIHtcbiAgY29uc3Qgc3VwYSA9IGdldFN1cGFBZG1pbigpO1xuICBjb25zdCB3aW5kb3dEYXlzID0gTWF0aC5tYXgoMSwgTWF0aC5taW4oMzY1LCBvcHRzPy53aW5kb3dEYXlzID8/IDMwKSk7XG4gIGNvbnN0IGxpbWl0ID0gTWF0aC5tYXgoMSwgTWF0aC5taW4oMTAwLCBvcHRzPy5saW1pdCA/PyAyNSkpO1xuICBjb25zdCBtaW5Db3VudCA9IE1hdGgubWF4KDAsIG9wdHM/Lm1pbkNvdW50ID8/IDApO1xuXG4gIC8vIFByZWZlciBhbiBSUEMgKGZhc3RlciAmIGNsZWFuZXIpLiBJZiB5b3UgYWRkIHRoaXMgaW4gREIsIHVuY29tbWVudCB0aGUgUlBDIGJsb2NrIGFuZCByZW1vdmUgZmFsbGJhY2suXG4gIGNvbnN0IHJwY1RyeSA9IGF3YWl0IHN1cGEucnBjKCd0b3BfaW5fZGVtYW5kX3NraWxscycsIHsgd2luZG93X2RheXM6IHdpbmRvd0RheXMsIHRvcF9saW1pdDogbGltaXQsIG1pbl9jb3VudDogbWluQ291bnQgfSk7XG4gIGlmICghcnBjVHJ5LmVycm9yICYmIHJwY1RyeS5kYXRhKSB7XG4gICAgcmV0dXJuIHsgb2s6IHRydWUsIGl0ZW1zOiBycGNUcnkuZGF0YSwgdmlhOiAncnBjJyB9O1xuICB9XG5cbiAgLy8gRmFsbGJhY2s6IGRvIGl0IHdpdGggUG9zdGdSRVNUIGZpbHRlcnMgKG1heSBiZSBzbG93ZXIgb24gbGFyZ2UgdGFibGVzKS5cbiAgLy8gV2UgY291bnQgc2tpbGxzIG9uIGpvYnMgY3JlYXRlZCBpbiB0aGUgd2luZG93LiBBZGp1c3QgY29sdW1uIG5hbWVzIGlmIG5lZWRlZC5cbiAgY29uc3Qgc2luY2VJU08gPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gd2luZG93RGF5cyAqIDg2NDAwMDAwKS50b0lTT1N0cmluZygpO1xuXG4gIC8vIFB1bGwgc2tpbGwgY291bnRzIGtleWVkIGJ5IHNraWxsLiBJZiB5b3UgaGF2ZSBhIG1hdGVyaWFsaXplZCB2aWV3LCB1c2UgdGhhdCBpbnN0ZWFkLlxuICBjb25zdCByZXMgPSBhd2FpdCBzdXBhXG4gICAgLmZyb20oJ2pvYl9za2lsbHMnKVxuICAgIC5zZWxlY3QoJ3NraWxsLCBqb2JzIWlubmVyKGNyZWF0ZWRfYXQpJylcbiAgICAuZ3RlKCdqb2JzLmNyZWF0ZWRfYXQnLCBzaW5jZUlTTyk7XG5cbiAgaWYgKHJlcy5lcnJvcikgdGhyb3cgbmV3IEVycm9yKGBqb2Jfc2tpbGxzOiAke3Jlcy5lcnJvci5tZXNzYWdlIHx8ICd1bmtub3duIGVycm9yJ31gKTtcblxuICBjb25zdCBjb3VudHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICBmb3IgKGNvbnN0IHJvdyBvZiAocmVzLmRhdGEgPz8gW10pIGFzIGFueVtdKSB7XG4gICAgY29uc3QgcyA9IChyb3cuc2tpbGwgPz8gJycpLnRyaW0oKTtcbiAgICBpZiAoIXMpIGNvbnRpbnVlO1xuICAgIGNvdW50cy5zZXQocywgKGNvdW50cy5nZXQocykgPz8gMCkgKyAxKTtcbiAgfVxuICBjb25zdCBpdGVtcyA9IFsuLi5jb3VudHMuZW50cmllcygpXVxuICAgIC5tYXAoKFtza2lsbCwgY291bnRdKSA9PiAoeyBza2lsbCwgY291bnQgfSkpXG4gICAgLmZpbHRlcigocikgPT4gci5jb3VudCA+PSBtaW5Db3VudClcbiAgICAuc29ydCgoYSwgYikgPT4gYi5jb3VudCAtIGEuY291bnQpXG4gICAgLnNsaWNlKDAsIGxpbWl0KTtcblxuICByZXR1cm4geyBvazogdHJ1ZSwgaXRlbXMsIHZpYTogJ2ZhbGxiYWNrJyB9O1xufVxuXG4vKipcbiAqIFNraWxscyBhIGNvdXJzZSB0ZWFjaGVzLCBhbmQgaG93IHRob3NlIG92ZXJsYXAgd2l0aCBjdXJyZW50IGRlbWFuZC5cbiAqIEFzc3VtZXMgY291cnNlX3NraWxscyhjb3Vyc2VfaWQgdXVpZCwgc2tpbGwgdGV4dClcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENvdXJzZVNraWxsQ292ZXJhZ2Uob3B0czogeyBjb3Vyc2VJZDogc3RyaW5nOyB3aW5kb3dEYXlzPzogbnVtYmVyIH0pIHtcbiAgY29uc3Qgc3VwYSA9IGdldFN1cGFBZG1pbigpO1xuICBjb25zdCB7IGNvdXJzZUlkIH0gPSBvcHRzO1xuICBjb25zdCB3aW5kb3dEYXlzID0gTWF0aC5tYXgoMSwgTWF0aC5taW4oMzY1LCBvcHRzPy53aW5kb3dEYXlzID8/IDMwKSk7XG5cbiAgLy8gMSkgY291cnNlIHNraWxsc1xuICBjb25zdCBjcyA9IGF3YWl0IHN1cGEuZnJvbSgnY291cnNlX3NraWxscycpLnNlbGVjdCgnc2tpbGwnKS5lcSgnY291cnNlX2lkJywgY291cnNlSWQpO1xuICBpZiAoY3MuZXJyb3IpIHRocm93IG5ldyBFcnJvcihgY291cnNlX3NraWxsczogJHtjcy5lcnJvci5tZXNzYWdlIHx8ICd1bmtub3duIGVycm9yJ31gKTtcbiAgY29uc3QgdGF1Z2h0ID0gbmV3IFNldCgoY3MuZGF0YSA/PyBbXSkubWFwKChyOiBhbnkpID0+IChyLnNraWxsID8/ICcnKS50cmltKCkpLmZpbHRlcihCb29sZWFuKSk7XG5cbiAgLy8gMikgdG9wIGRlbWFuZFxuICBjb25zdCB0b3AgPSBhd2FpdCBnZXRUb3BJbkRlbWFuZFNraWxscyh7IHdpbmRvd0RheXMsIGxpbWl0OiAyMDAgfSk7XG4gIGNvbnN0IGRlbWFuZFNldCA9IG5ldyBTZXQoKHRvcC5pdGVtcyA/PyBbXSkubWFwKChyOiBhbnkpID0+IHIuc2tpbGwpKTtcblxuICBjb25zdCBjb3ZlcmVkID0gWy4uLnRhdWdodF0uZmlsdGVyKChzKSA9PiBkZW1hbmRTZXQuaGFzKHMpKTtcbiAgY29uc3QgbWlzc2luZyA9IFsuLi5kZW1hbmRTZXRdLmZpbHRlcigocykgPT4gIXRhdWdodC5oYXMocykpO1xuXG4gIGNvbnN0IGNvdmVyYWdlUGN0ID0gdGF1Z2h0LnNpemUgPyBOdW1iZXIoKChjb3ZlcmVkLmxlbmd0aCAvIHRhdWdodC5zaXplKSAqIDEwMCkudG9GaXhlZCgxKSkgOiAwO1xuXG4gIHJldHVybiB7XG4gICAgb2s6IHRydWUsXG4gICAgY291cnNlSWQsXG4gICAgY291bnRzOiB7IHRhdWdodDogdGF1Z2h0LnNpemUsIGNvdmVyZWQ6IGNvdmVyZWQubGVuZ3RoLCBtaXNzaW5nOiBtaXNzaW5nLmxlbmd0aCB9LFxuICAgIGNvdmVyYWdlUGN0LFxuICAgIGNvdmVyZWRTa2lsbHM6IGNvdmVyZWQsXG4gICAgbWlzc2luZ1NraWxsczogbWlzc2luZyxcbiAgfTtcbn1cblxuLyoqXG4gKiBNaXNzaW5nIGluLWRlbWFuZCBza2lsbHMgZm9yIGEgc3BlY2lmaWMgY291cnNlICh3aXRoIHRocmVzaG9sZHMpLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0TWlzc2luZ1NraWxsc0ZvckNvdXJzZShvcHRzOiB7IGNvdXJzZUlkOiBzdHJpbmc7IHdpbmRvd0RheXM/OiBudW1iZXI7IG1pbkNvdW50PzogbnVtYmVyOyBsaW1pdD86IG51bWJlciB9KSB7XG4gIGNvbnN0IHsgY291cnNlSWQgfSA9IG9wdHM7XG4gIGNvbnN0IHdpbmRvd0RheXMgPSBNYXRoLm1heCgxLCBNYXRoLm1pbigzNjUsIG9wdHM/LndpbmRvd0RheXMgPz8gMzApKTtcbiAgY29uc3QgbWluQ291bnQgPSBNYXRoLm1heCgwLCBvcHRzPy5taW5Db3VudCA/PyAzKTtcbiAgY29uc3QgbGltaXQgPSBNYXRoLm1heCgxLCBNYXRoLm1pbigyMDAsIG9wdHM/LmxpbWl0ID8/IDUwKSk7XG5cbiAgY29uc3QgW2NvdmVyYWdlLCB0b3BdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgIGdldENvdXJzZVNraWxsQ292ZXJhZ2UoeyBjb3Vyc2VJZCwgd2luZG93RGF5cyB9KSxcbiAgICBnZXRUb3BJbkRlbWFuZFNraWxscyh7IHdpbmRvd0RheXMsIGxpbWl0OiA1MDAsIG1pbkNvdW50IH0pLFxuICBdKTtcblxuICBjb25zdCBtaXNzaW5nUmFua2VkID0gKHRvcC5pdGVtcyA/PyBbXSlcbiAgICAuZmlsdGVyKChyOiBhbnkpID0+IChjb3ZlcmFnZS5taXNzaW5nU2tpbGxzID8/IFtdKS5pbmNsdWRlcyhyLnNraWxsKSlcbiAgICAuc2xpY2UoMCwgbGltaXQpO1xuXG4gIHJldHVybiB7XG4gICAgb2s6IHRydWUsXG4gICAgY291cnNlSWQsXG4gICAgbWlzc2luZzogbWlzc2luZ1JhbmtlZCwgLy8gW3tza2lsbCwgY291bnR9XVxuICAgIGNvdmVyYWdlUGN0OiBjb3ZlcmFnZS5jb3ZlcmFnZVBjdCxcbiAgfTtcbn1cblxuLyoqXG4gKiBBbGlnbm1lbnQgc3VtbWFyeSBmb3IgYSBjb3Vyc2Ugb3IgZ2xvYmFsbHkuXG4gKiBBc3N1bWVzIGNvdXJzZV9hbGlnbm1lbnRfc2NvcmVzKGNvdXJzZV9pZCwgc2NvcmUsIGNhbGN1bGF0ZWRfYXQpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbGlnbm1lbnRTdW1tYXJ5KG9wdHM/OiB7IGNvdXJzZUlkPzogc3RyaW5nOyB3aW5kb3dEYXlzPzogbnVtYmVyIH0pIHtcbiAgY29uc3Qgc3VwYSA9IGdldFN1cGFBZG1pbigpO1xuICBjb25zdCB3aW5kb3dEYXlzID0gTWF0aC5tYXgoMSwgTWF0aC5taW4oMzY1LCBvcHRzPy53aW5kb3dEYXlzID8/IDkwKSk7XG4gIGNvbnN0IHNpbmNlSVNPID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIHdpbmRvd0RheXMgKiA4NjQwMDAwMCkudG9JU09TdHJpbmcoKTtcblxuICBsZXQgcSA9IHN1cGFcbiAgICAuZnJvbSgnY291cnNlX2FsaWdubWVudF9zY29yZXMnKVxuICAgIC5zZWxlY3QoJ2NvdXJzZV9pZCxzY29yZSxjYWxjdWxhdGVkX2F0JylcbiAgICAuZ3RlKCdjYWxjdWxhdGVkX2F0Jywgc2luY2VJU08pXG4gICAgLm9yZGVyKCdjYWxjdWxhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xuXG4gIGlmIChvcHRzPy5jb3Vyc2VJZCkgcSA9IHEuZXEoJ2NvdXJzZV9pZCcsIG9wdHMuY291cnNlSWQpO1xuXG4gIGNvbnN0IHJlcyA9IGF3YWl0IHE7XG4gIGlmIChyZXMuZXJyb3IpIHRocm93IG5ldyBFcnJvcihgY291cnNlX2FsaWdubWVudF9zY29yZXM6ICR7cmVzLmVycm9yLm1lc3NhZ2UgfHwgJ3Vua25vd24gZXJyb3InfWApO1xuXG4gIGNvbnN0IHJvd3MgPSByZXMuZGF0YSA/PyBbXTtcbiAgaWYgKG9wdHM/LmNvdXJzZUlkKSB7XG4gICAgY29uc3QgYXZnID1cbiAgICAgIHJvd3MucmVkdWNlKChhLCByOiBhbnkpID0+IGEgKyAoci5zY29yZSA/PyAwKSwgMCkgLyBNYXRoLm1heChyb3dzLmxlbmd0aCwgMSk7XG4gICAgcmV0dXJuIHsgb2s6IHRydWUsIGNvdXJzZUlkOiBvcHRzLmNvdXJzZUlkLCBhdmc6IE51bWJlcihhdmcudG9GaXhlZCgyKSksIG46IHJvd3MubGVuZ3RoIH07XG4gIH1cblxuICAvLyBnbG9iYWwgcGVyLWNvdXJzZSBhdmdcbiAgY29uc3QgbWFwID0gbmV3IE1hcDxzdHJpbmcsIHsgc3VtOiBudW1iZXI7IG46IG51bWJlciB9PigpO1xuICBmb3IgKGNvbnN0IHIgb2Ygcm93cyBhcyBhbnlbXSkge1xuICAgIGNvbnN0IGsgPSBTdHJpbmcoci5jb3Vyc2VfaWQgPz8gJycpO1xuICAgIGNvbnN0IG0gPSBtYXAuZ2V0KGspID8/IHsgc3VtOiAwLCBuOiAwIH07XG4gICAgbS5zdW0gKz0gci5zY29yZSA/PyAwO1xuICAgIG0ubiArPSAxO1xuICAgIG1hcC5zZXQoaywgbSk7XG4gIH1cbiAgY29uc3QgaXRlbXMgPSBbLi4ubWFwLmVudHJpZXMoKV0ubWFwKChbY291cnNlSWQsIHsgc3VtLCBuIH1dKSA9PiAoe1xuICAgIGNvdXJzZUlkLFxuICAgIGF2ZzogTnVtYmVyKChzdW0gLyBNYXRoLm1heChuLCAxKSkudG9GaXhlZCgyKSksXG4gICAgbixcbiAgfSkpO1xuICBpdGVtcy5zb3J0KChhLCBiKSA9PiBiLmF2ZyAtIGEuYXZnKTtcbiAgcmV0dXJuIHsgb2s6IHRydWUsIGl0ZW1zIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHRyeUxvYWREYXRhU2VydmljZSgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBtb2QgPSAoYXdhaXQgaW1wb3J0KCcuLi8uLi8uLi9saWIvZGF0YVNlcnZpY2UnKSkgYXMgYW55O1xuICAgIHJldHVybiBtb2Q7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRJbkRlbWFuZFNraWxsc1ZpYVNlcnZpY2Uob3B0cz86IHsgd2luZG93RGF5cz86IG51bWJlcjsgbGltaXQ/OiBudW1iZXI7IG1pbkNvdW50PzogbnVtYmVyIH0pIHtcbiAgY29uc3Qgc3ZjID0gYXdhaXQgdHJ5TG9hZERhdGFTZXJ2aWNlKCk7XG4gIGlmIChzdmM/LmdldEluRGVtYW5kU2tpbGxzKSByZXR1cm4gc3ZjLmdldEluRGVtYW5kU2tpbGxzKG9wdHMgPz8ge30pO1xuICAvLyBGYWxsYmFjayB0byBvdXIgREIgbWV0aG9kXG4gIHJldHVybiBnZXRUb3BJbkRlbWFuZFNraWxscyhvcHRzKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1pc3NpbmdTa2lsbHNGb3JDb3Vyc2VWaWFTZXJ2aWNlKG9wdHM6IHsgY291cnNlSWQ6IHN0cmluZzsgd2luZG93RGF5cz86IG51bWJlcjsgbWluQ291bnQ/OiBudW1iZXI7IGxpbWl0PzogbnVtYmVyIH0pIHtcbiAgY29uc3Qgc3ZjID0gYXdhaXQgdHJ5TG9hZERhdGFTZXJ2aWNlKCk7XG4gIGlmIChzdmM/LmdldE1pc3NpbmdTa2lsbHNGb3JDb3Vyc2UpIHJldHVybiBzdmMuZ2V0TWlzc2luZ1NraWxsc0ZvckNvdXJzZShvcHRzKTtcbiAgcmV0dXJuIGdldE1pc3NpbmdTa2lsbHNGb3JDb3Vyc2Uob3B0cyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb3Vyc2VTa2lsbENvdmVyYWdlVmlhU2VydmljZShvcHRzOiB7IGNvdXJzZUlkOiBzdHJpbmc7IHdpbmRvd0RheXM/OiBudW1iZXIgfSkge1xuICBjb25zdCBzdmMgPSBhd2FpdCB0cnlMb2FkRGF0YVNlcnZpY2UoKTtcbiAgaWYgKHN2Yz8uZ2V0Q291cnNlU2tpbGxDb3ZlcmFnZSkgcmV0dXJuIHN2Yy5nZXRDb3Vyc2VTa2lsbENvdmVyYWdlKG9wdHMpO1xuICByZXR1cm4gZ2V0Q291cnNlU2tpbGxDb3ZlcmFnZShvcHRzKTtcbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJnZXRTdXBhQWRtaW4iLCJ1cmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwia2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIiwiZ2V0TGF0ZXN0S1BJcyIsInN1cGEiLCJqb2JzSGVhZCIsImNvdXJzZXNIZWFkIiwic2NvcmVzUmVzIiwiUHJvbWlzZSIsImFsbCIsImZyb20iLCJzZWxlY3QiLCJoZWFkIiwiY291bnQiLCJvcmRlciIsImFzY2VuZGluZyIsImxpbWl0IiwiZXJyb3IiLCJtZXNzYWdlIiwiam9iX2NvdW50IiwiY291cnNlX2NvdW50Iiwic2NvcmVzIiwiZGF0YSIsImF2ZyIsInJlZHVjZSIsImEiLCJiIiwic2NvcmUiLCJNYXRoIiwibWF4IiwibGVuZ3RoIiwibGF0ZXN0X2FsaWdubWVudF9hdmciLCJOdW1iZXIiLCJpc0Zpbml0ZSIsInRvRml4ZWQiLCJfc291cmNlIiwiZ2V0VG9wSW5EZW1hbmRTa2lsbHMiLCJvcHRzIiwid2luZG93RGF5cyIsIm1pbiIsIm1pbkNvdW50IiwicnBjVHJ5IiwicnBjIiwid2luZG93X2RheXMiLCJ0b3BfbGltaXQiLCJtaW5fY291bnQiLCJvayIsIml0ZW1zIiwidmlhIiwic2luY2VJU08iLCJEYXRlIiwibm93IiwidG9JU09TdHJpbmciLCJyZXMiLCJndGUiLCJjb3VudHMiLCJNYXAiLCJyb3ciLCJzIiwic2tpbGwiLCJ0cmltIiwic2V0IiwiZ2V0IiwiZW50cmllcyIsIm1hcCIsImZpbHRlciIsInIiLCJzb3J0Iiwic2xpY2UiLCJnZXRDb3Vyc2VTa2lsbENvdmVyYWdlIiwiY291cnNlSWQiLCJjcyIsImVxIiwidGF1Z2h0IiwiU2V0IiwiQm9vbGVhbiIsInRvcCIsImRlbWFuZFNldCIsImNvdmVyZWQiLCJoYXMiLCJtaXNzaW5nIiwiY292ZXJhZ2VQY3QiLCJzaXplIiwiY292ZXJlZFNraWxscyIsIm1pc3NpbmdTa2lsbHMiLCJnZXRNaXNzaW5nU2tpbGxzRm9yQ291cnNlIiwiY292ZXJhZ2UiLCJtaXNzaW5nUmFua2VkIiwiaW5jbHVkZXMiLCJnZXRBbGlnbm1lbnRTdW1tYXJ5IiwicSIsInJvd3MiLCJuIiwiayIsIlN0cmluZyIsImNvdXJzZV9pZCIsIm0iLCJzdW0iLCJ0cnlMb2FkRGF0YVNlcnZpY2UiLCJtb2QiLCJnZXRJbkRlbWFuZFNraWxsc1ZpYVNlcnZpY2UiLCJzdmMiLCJnZXRJbkRlbWFuZFNraWxscyIsImdldE1pc3NpbmdTa2lsbHNGb3JDb3Vyc2VWaWFTZXJ2aWNlIiwiZ2V0Q291cnNlU2tpbGxDb3ZlcmFnZVZpYVNlcnZpY2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/carly/tools.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "./work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "?32c4":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?66e9":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?7f96":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?8cce":
/*!********************************!*\
  !*** supports-color (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?d1cc":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "next/dist/shared/lib/no-fallback-error.external":
/*!******************************************************************!*\
  !*** external "next/dist/shared/lib/no-fallback-error.external" ***!
  \******************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/no-fallback-error.external");

/***/ }),

/***/ "next/dist/shared/lib/router/utils/app-paths":
/*!**************************************************************!*\
  !*** external "next/dist/shared/lib/router/utils/app-paths" ***!
  \**************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/app-paths");

/***/ }),

/***/ "node:events":
/*!******************************!*\
  !*** external "node:events" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:events");

/***/ }),

/***/ "node:process":
/*!*******************************!*\
  !*** external "node:process" ***!
  \*******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:process");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "node:util":
/*!****************************!*\
  !*** external "node:util" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:util");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/ws","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/isows","vendor-chunks/google-auth-library","vendor-chunks/uuid","vendor-chunks/zod","vendor-chunks/gaxios","vendor-chunks/jws","vendor-chunks/debug","vendor-chunks/json-bigint","vendor-chunks/google-logging-utils","vendor-chunks/https-proxy-agent","vendor-chunks/gcp-metadata","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/agent-base","vendor-chunks/node-fetch","vendor-chunks/@google","vendor-chunks/safe-buffer","vendor-chunks/ms","vendor-chunks/jwa","vendor-chunks/is-stream","vendor-chunks/gtoken","vendor-chunks/extend","vendor-chunks/buffer-equal-constant-time","vendor-chunks/bignumber.js","vendor-chunks/base64-js"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fcarly%2Froute&page=%2Fapi%2Fcarly%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcarly%2Froute.ts&appDir=%2FUsers%2Fstal%2FDocuments%2FProjects%2Fcurricalign%2Ffrontend%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fstal%2FDocuments%2FProjects%2Fcurricalign%2Ffrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!")));
module.exports = __webpack_exports__;

})();